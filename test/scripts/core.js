function muted(e,t,i){var i="undefined"===Est.typeOf(i)?!0:i;if(audio&&audio.muted&&i){audio.muted=!1,audio.play();var o=$("#"+e);o.hasClass("on")||o.find(".btn_music").addClass("on"),$(t).find(".move").html("")}else audio.muted=!0,audio.pause(),$("#"+e).find(".btn_music").removeClass("on"),$(t).find(".move").html("")}function showVideo(e){var t=$(e).parents(".video-con:first"),i=t.find("video").get(0);return t.addClass("video-cover"),t.find(".img").hide(),t.find(".video-hide").removeClass("video-hide"),data.music&&!Est.isEmpty(data.music.path)&&muted("firefox",$("#musicWrap").get(0),!1),i.play(),t.click(function(){}),video_on=!0,!1}function closeVideo(e){var t=$(e).parents(".video-con:first");return t.removeClass("video-cover"),t.find(".img").show(),t.find(".video").addClass("video-hide"),$(e).find("video").get(0).pause(),video_on=!0,!1}function removeCover(){return!1}function setImagePreview(e,t){$(e).parent("form").addClass("isUpdate"),Est.imagePreview({inputFile:e,imgNode:$("#"+t).get(0)})}function doUpload(e,t){return $(".form-01").each(function(){if($(this).hasClass("isUpdate")){updateImgCount+=1,$(this).find("input[name=wyId]").val(e),$(this).find("input[name=mobile]").val(t);var i=$(this);setTimeout(function(){i.ajaxSubmit({type:"post",async:!0,success:function(){},error:function(e){alert(e)}})},0)}}),!1}function getObjectURL(e){var t=null;return void 0!=window.createObjectURL?t=window.createObjectURL(e):void 0!=window.URL?t=window.URL.createObjectURL(e):void 0!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}function pshow(){var e=$("body").width()-40,t=$("body").height()-40;document.cookie="url_cookie="+escape("?arg="+_arg)+";",location.href="http://"+appdomain+"/wwy/forwarding?arg="+_arg,0==$(".form-01").size()&&Est.isEmpty(canvasSrc)?location.href="http://"+appdomain+"/wwy/forwarding?arg="+_arg:popWin.showWin(e,t,title+"_转发页面","http://"+appdomain+"/wwy/forwarding?arg="+_arg)}function forwarding(e){document.cookie="url_cookie="+escape("?arg="+arg)+";",location.href=e}function validateCellPhone(e){var t={regEmail:/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/,regMobile:/^0?1[3|4|5|8][0-9]\d{8}$/,regTel:/^0[\d]{2,3}-[\d]{7,8}$/},i=t.regMobile.test(e);return i?!0:!1}function beforeLottery(e){return isShare?!0:Est.isEmpty(_mobile)?enterMobileDialog(e):toShareWwyDialog(e)}function resolveResult(e){var t=$.parseJSON(Est.unescapeHTML(e));lotterySort=t.sort,lotteryInfo=t.info,lotyId=t.lotyId,drawText($("#lottery_gg"),lotteryInfo,ga_width,ga_height,ga_left,ga_top),console.log(t),isShare=!0}function bindWeixinJSBridge(e){var t="http://"+appdomain+"/wwy/info?arg="+e.split(";")[0],i="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appid+"&redirect_uri="+t+"&response_type=code&scope=snsapi_base&state=0#wechat_redirect";try{"undefined"!=typeof WeixinJSBridge&&(WeixinJSBridge.on("menu:share:appmessage",function(){WeixinJSBridge.invoke("sendAppMessage",{link:i,img_url:sharepic,desc:sharedesc,title:sharetitle},function(e){"send_app_msg:ok"===e.err_msg&&(isShare=!0),isShare&&ltyType?(insertLottery(_wwyId,_mobile),$("#share-div").remove()):alert("分享未成功！错误代码："+e.err_msg)})}),WeixinJSBridge.on("menu:share:timeline",function(){WeixinJSBridge.invoke("shareTimeline",{link:i,img_url:sharepic,desc:sharedesc,title:sharetitle},function(e){"share_timeline:ok"===e.err_msg&&(isShare=!0),isShare&&ltyType?(insertLottery(_wwyId,_mobile),$("#share-div").remove()):alert("分享未成功！错误代码："+e.err_msg)})}))}catch(o){console.error("pc端无微信接口！")}}function getLottery(e,t){var i=e||i;Est.isEmpty(t)?$.ajax({type:"post",url:"/wwy/getLottery",async:!1,data:{id:_wwyId,mobile:i},success:function(e){"00"!==e?resolveResult(e):isShare=!1}}):"00"!==t?resolveResult(t):isShare=!1}function drawText(e,t,i,o,a,n){Est.isEmpty(_mobile)||$(e).drawcanvas({coverType:"text",cover:t,fontSize:12,lineWidth:20,fillImage:!0,width:i,height:o,left:a,top:n,shaveable:!1,position:"absolute",zIndex:98,callback:function(){},success:function(){}})}function drawLotteryList(){var e='<li>恭喜#{mobile}获得了<span style="color: #e12e60">#{lotyName}</span></li>',t=$(".lottery-item-ul");t.empty(),$.ajax({type:"post",url:"/wwy/getLotteryList",data:{id:_wwyId},success:function(i){var o=$.parseJSON(i);Est.each(o,function(i){i.mobile=i.mobile.replace(/(\d{3})\d{4}(\d{4})/g,"$1****$2"),t.append($(Est.format(e,i)))}),t.show()}})}function drawLotteryRule(){var e="<li>#{level}：#{name}</li>",t=$(".lty-rule .lty-rule-ul");t.empty(),Est.each(ltyRule.lotteryRule.slice(0,ltyRule.lotteryRule.length-1),function(i){t.append(Est.format(e,i))})}function disableLottery(){isShare=!1,lotyId=null}function enterMobileDialog(){if(!(isShare||$("#enter-mobile-div").size()>0)){var e,t,i="<div id='enter-mobile-div' class='dialog' style=''><div class=\"content\"><span>请输入您的手机号码：</span><input name='mobile' type='number' class=\"text\" value='#{mobile}'></input><br><input name='submit' class=\"btn\" type='button' value='确定'></input><input name='cancel' class=\"btn\" type='button' value='关闭'></input></div></div>",o=$(Est.format(i,{mobile:_mobile}));$("input[name=mobile]",o).on("click",function(){e&&e.remove()}),$("input[name=submit]",o).on("click",function(){e=$("<div class='errTip' style='color:red;'>您输入的电话号码有误</div>");var t="",i=$.trim($(this).parents("#enter-mobile-div:first").find("input[name=mobile]").val());return Est.validation(i,"cellphone")?(e.remove(),_mobile=i,$.ajax({url:"/wwy/join",async:!0,data:{mobile:_mobile,arg:_arg},success:function(e){t=e}}),setTimeout(function(){t=Est.isEmpty(t)?_arg:t,bindWeixinJSBridge(t)},2e3),o.remove(),void toShareWwyDialog()):void(0==o.has(".errTip").size()&&$(this).before(e))}),$("input[name=cancel]",o).on("click",function(e){e.preventDefault(),o.remove()}),$("body").append(o),t=Est.center($(window).width(),$(window).height(),o.width(),o.height()),o.css({left:t.left,top:"20%"}),Est.isEmpty(_mobile)||getLottery(_mobile),setTimeout(function(){},1e3)}}function toShareWwyDialog(){if(!(isShare||$("#share-div").size()>0)){var e,t,i='<div id=\'share-div\' class="dialog"><div class="content">请点击右上角的分享按钮：<div><img height="25" style="float:left;margin-right:5px;" src="/wwy/theme1/image/ico1.jpg" /><img height="25" style="float:left;margin-right:5px;" src="/wwy/theme1/image/ico2.jpg" /><img  height="25" style="float:left;margin-right:5px;" src="/wwy/theme1/image/ico3.jpg" /></div><div class="" style="clear:both;">分享你的专属页面， 分享后即可进行抽奖;<br> 每分享一个人即可获取一次抽奖机会</div></div></div>';e=$(i),$("body").append(e),t=Est.center($(window).width(),$(window).height(),e.width(),e.height()),e.css({left:t.left,top:"20%"})}}function drawSector(e,t,i,o,a,n,r,s){Canvas.drawSector(e,t,i,o,a,n,{before:function(){},after:function(e){e.globalAlpha=s,e.fillStyle=r,e.fill()}})}function drawCircleText(e,t,i,o,a,n,r){var s=(Math.PI*(t-i)/o,n*a+90),l=s-360>360?s-360:s,d=Canvas.getCircleLocation(t,t,.9*(t-i),l),c=e.getContext("2d"),u=a*n+90;u=Canvas.getDegreeByCircle(u,a,n),c.save(),c.beginPath(),c.fillStyle="#444",c.font="12px Arial";var h=c.measureText(r).width;c.translate(d.x,d.y),c.rotate(-u*Math.PI/180),c.fillText(r,-h/2,6),c.restore()}function drawImage(e,t,i,o,a,n){var r=Math.PI*(e-t)*.6/i,s=a*o+90,l=s-360>360?s-360:s,d=Canvas.getCircleLocation(e,e,.8*(e-t)/2+21,l),c={style:"position:absolute;;left:"+(d.x-r/2)+"px;top:"+(d.y-r/2)+"px;background-color:transparent;z-index:98;",width:r,height:r,sort:a},u=Canvas.createElement("canvas",c);$(".rotate .rotate-bg").append($(u));var h=new Image;h.onload=function(){var e=Est.imageCrop(this.naturalWidth,this.naturalHeight,r,r,!0);Canvas.drawImage({canvas:u,image:h,desx:e.marginLeft,desy:e.marginTop,desw:e.width,desh:e.height,opacity:.85})},h.src=n}function shared(e){return _mobile=e,isShare=!0,insertLottery(_wwyId,_mobile),$("#share-div").remove(),!0}function getClientSize(){var e="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,t="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;height=Math.max($(window).height(),e),width=Math.max($(window).width(),t)}function orientationChange(){switch(window.orientation){case 0:case 180:break;case-90:case 90:}}var audio,lotterySort=0,lotteryInfo="",clickType="ontouchend"in window?"touchend":"click",initAudio=function(){audio=document.getElementById("audio"),Est.isEmpty(data)||Est.isEmpty(data.music)?$("#musicWrap").hide():audio&&muted("firefox",audio,!0)};$(function(){initAudio(),$("#musicWrap").click(function(){var e=this;muted("musicWrap",e)})});var video_on=!1,insertLottery=function(e,t){$.ajax({type:"post",url:"/wwy/insertLottery",data:{id:e,mobile:t},success:function(e){top&&top.getLottery&&top.getLottery(t,e)}})};if("1"===ltyType){var image=ltyRule.lotteryImage;$(".zf_button").hide(),$("#lottery_gg").drawcanvas({coverType:"image",cover:image,lineWidth:15,fillImage:!1,shaveable:!0,cbdelay:0,position:"absolute",left:ga_left,top:ga_top,zIndex:99,beforeCallback:function(){return beforeLottery($("#lottery_gg").get(0))?!0:!1},callback:function(e){e>50&&isShare&&(lotyId&&drawLotteryList(),drawLotteryList())},success:function(){ga_width=parseInt(this.mask.getAttribute("width"),10),ga_height=parseInt(this.mask.getAttribute("height"),10),$(this.conNode).addClass("show").on("webkitTransitionEnd",function(){})}}),drawLotteryList(),drawLotteryRule()}if("2"===ltyType){$(".zf_button").hide(),$(".rotate-bg img:first").attr("src",ltyRule.lotteryImage);var rules=ltyRule.lotteryRule,len=rules.length,deg=Math.round(360/len);if("01"!==ltyRule.customImage){var colors=["#FECB03","#2FB753","#6B3983","#DE47CD","#A33EE5","#2E9CD9","#E73EAA","#2FB753","#FECB03","#6B3983","#A33EE5","#DE47CD","#2E9CD9","#E73EAA"],$rotateBg=$(".rotate .rotate-bg"),width=$rotateBg.width(),radius=width/2,inner_width=9,color=null,step=0,$sector=$("<canvas id='sector'></canvas>");$sector.attr({width:width,height:width}),$sector.css({position:"absolute",left:0,top:0,"z-index":97}),$rotateBg.append($sector);var sector=$sector.get(0);drawSector(sector,radius,radius,radius-inner_width,0,360,"#fff",1);for(var i=0;len>i;i++)color=i%2===0?"#e6e4db":colors[Math.ceil(i/2)],drawSector(sector,radius,radius,radius-inner_width,i*deg+90-deg/2,(i+1)*deg+90-deg/2,color,.6),drawSector(sector,radius,radius,.8*(radius-inner_width),i*deg+90-deg/2,(i+1)*deg+90-deg/2,color,.75),drawSector(sector,radius,radius,.75*(radius-inner_width),i*deg+90-deg/2,(i+1)*deg+90-deg/2,color,1);Est.each(rules,function(e,t){drawImage(radius,inner_width,len,deg,t+1,e.pic),drawCircleText(sector,radius,inner_width,len,deg,t+1,e.name)})}$(".rotate-start").bind(clickType,function(e){if(e.stopPropagation(),e.preventDefault(),!beforeLottery($(".rotate-start").get(0)))return!1;if(Est.isEmpty(_mobile)||!isShare)return alert("请先转发并发享， 再抽奖"),!1;var t=deg*lotterySort;$("#J_startBtn").stopRotate(),$("#J_startBtn").rotate({angle:0,duration:4e3,animateTo:t+5400,callback:function(){var e="<div id='okDialog' class='dialog'><div class=\"content\">#{info}<br><input name='ok' class=\"ok btn\" type='button' value='确定'></input></div></div>";lotyId&&drawLotteryList(),disableLottery(),lotterySort=len;var t=$(Est.format(e,{info:lotteryInfo}));t.find(".ok").click(function(){$(this).parents(".dialog:first").remove()}),$("body").append(t),t.css(Est.center($(window).width(),$(window).height(),t.width(),t.height()))}})}),drawLotteryList()}if("3"===ltyType){$(".zf_button").hide();var image=ltyRule.lotteryImage;$("#lottery_swing").drawcanvas({coverType:"image",cover:image,shaveable:!1,fillImage:!0,width:ga_width,height:ga_height,position:"absolute",left:swing_left,top:swing_top,zIndex:99,success:function(){if($(this.conNode).addClass("show"),window.DeviceMotionEvent){var e=25,t=y=z=lastX=lastY=lastZ=0;window.addEventListener("devicemotion",function(){var i=event.accelerationIncludingGravity;if(t=i.x,y=i.y,Math.abs(t-lastX)>e||Math.abs(y-lastY)>e){if(!beforeLottery($("#lottery_swing").get(0)))return!1;isShare?(alert(lotteryInfo),lotyId&&drawLotteryList(),disableLottery()):alert("请先转发并发享， 再摇奖")}lastX=t,lastY=y},!1)}}}),drawLotteryList(),drawLotteryRule()}data&&data.hidShare&&$("#section19").insertAfter($("#fullpage")).hide(),data&&data.hidZf&&$("#section21").insertAfter($("#fullpage")).hide(),canvasSrc=$("#lottery").attr("data-src");var canvas=null,context2D=null,width=0,height=0;if(getClientSize(),!Est.isEmpty(canvasSrc)){var array_paint=[];getClientSize(),$("#lottery").drawcanvas({coverType:"image",cover:"/wwy/img/"+canvasSrc,lineWidth:20,fillImage:!0,width:width,height:height,shaveable:!0,cbdelay:10,zIndex:9999999,callback:function(e){console.log(e),e>30&&($("#fullpage").fullpage({scrollingSpeed:450,afterRender:function(){$("#fullpage .tip").remove()}}),$(this).parent().removeClass("show").on("webkitTransitionEnd",function(){$(this).hide()}))},success:function(){setTimeout(function(){$(".loading").remove()},1e3),$(this.conNode).addClass("show").on("webkitTransitionEnd",function(){})}})}$(function(){$(".forward-btn").click(function(){pshow()}),$("#mainMessageForm").submit(function(){return""==$(".title").val()?($(".error_span").html("姓名不能为空"),!1):0!=$(".email").length&&""==$(".email").val()?($(".error_span").html("邮箱不能为空"),!1):0!=$(".phone").length&&""==$(".phone").val()?($(".error_span").html("电话不能为空"),!1):0!=$(".entName").length&&""==$(".entName").val()?($(".error_span").html("公司名称不能为空"),!1):0!=$(".job").length&&""==$(".job").val()?($(".error_span").html("职务不能为空"),!1):0!=$("#join_cont").length&&""==$("#join_cont").val()?($(".error_span").html("留言内容不能为空"),!1):0!=$("#join_mobile").length&&""==$("#join_mobile").val()?($(".error_span").html("电话号码输入错误!"),!1):0!=$("#join_mobile").length&&$("#join_mobile").val().length<5?($(".error_span").html("电话号码输入错误!"),!1):($(".error_span").html(""),$.ajax({url:"/wwy/msg/send",data:{title:$(".t_before").val(),name:void 0==$(".title").val()?"":$(".title").val(),email:void 0==$(".email").val()?"":$(".email").val(),phone:void 0==$(".phone").val()?"":$(".phone").val(),entName:void 0==$(".entName").val()?"":$(".entName").val(),job:void 0==$(".job").val()?"":$(".job").val(),mobile:void 0==$("#join_mobile").val()?"":$("#join_mobile").val(),content:void 0==$("#join_cont").val()?"":$("#join_cont").val(),wwyId:_wwyId,enterpriseId:enterpriseId,openid:openid},success:function(){$(".error_span").html("发送成功!"),$("#mainMessageForm")[0].reset(),setTimeout(function(){$(".error_span").html("")},3e3)}}),!1)})}),$(function(){var e=e,t=_wwyId;setTimeout(function(){$.ajax({url:"/wwy/saveBySecond",data:{wyId:t,infoId:e,time:"5"}})},5e3),setTimeout(function(){$.ajax({url:"/wwy/saveBySecond",data:{wyId:t,infoId:e,time:"10"}})},1e4)}),$(function(){setTimeout(function(){$("#fullpage .tip").remove()},3e3),$("#image").css({height:height+"px",width:width+"px"}),Est.isEmpty(canvasSrc)&&$("#fullpage").fullpage({scrollingSpeed:450,afterRender:function(){$(".loading").remove(),$("#fullpage .tip").remove()}})}),window.addEventListener("onorientationchange"in window?"orientationchange":"resize",orientationChange,!1);
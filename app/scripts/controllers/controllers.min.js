"use strict";function del_index_by_id(e,t){var o,n=e.product_result_data;for(var a in n)if(n[a].product_id==t){o=a;break}n.splice(o,1)}function update_sort_by_id(e,t,o,n){Est.filter(e.product_result_data,{product_id:t})[0].sort=o,n&&(e.product_result_data=Est.sortBy(e.product_result_data,function(e){return-1*parseInt(e.sort)}))}function update_category_by_id(e,t){$rootScope.ajax({method:"PUT",url:"product/"+e,data:{category:t}})}app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"modules/MainPage/main.html"})}]),app.controller("MainCtrl",["$scope","$rootScope","WEBSITE_URL",function(e,t,o){e.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],e.showMessage=function(){t.showMsg("努力开发中,即将上线！",{type:"warning",time:3e3})},e.jumpToDesign=function(){return"00"===t.sessionuser.grade?void t.showMsg("免费用户不能访问设计页面！",{type:"warning",time:3e3}):void t.jumpUrl(o,!1)}}]),app.run(["$rootScope","$location","$q","$http","API_END_POINT",function(e,t,o,n,a){function r(){var t=o.defer();return n.get(a+"profile").success(function(o){e.user=o.username,e.sessionuser=o,e.usertype={"00":"免费版","01":"展示版","02":"营销版","03":"策划版"},t.resolve("profile")}),n.get(a+"enterprise").success(function(o){e.enterprise=o,t.resolve("enterprise")}),t.promise}e.current_page="",e.$on("$routeChangeStart",function(){var s=o.defer();return n.get(a).success(function(o){o&&o.isLogin?(s.resolve("okay"),e.isLogin=!0,r()):(s.reject("not yet"),e.isLogin=!1,"/login"===t.path()||"/register_pass"===t.path()||"/register_result"===t.path()||"/register_result"===t.path()||"/register"===t.path()||e.isLogin||t.path("/login"),"/login"===t.path()&&e.isLogin&&t.path("/"))}).error(function(){s.resolve("network is not fine"),e.isLogin=!1,t.path("/login")}),s.promise}),t.path(t.path()),e.logout=function(){e.isLogin&&n.post(a+"logout").success(function(o){e.showMsg(o.msg||"您已成功登出"),setTimeout(function(){e.sessionuser=null,e.enterprise=null,e.user=null,t.path("/login")},100)}).error(function(t){e.showMsg(t.err||"登出失败！",{type:"danger"})})}}]),app.config(["$routeProvider",function(e){e.when("/login",{templateUrl:"modules/Account/views/login.html",controller:"LoginCtrl",title:"用户登录"})}]),app.controller("LoginCtrl",["$scope","$rootScope","$location","$http","API_END_POINT",function(e,t,o,n,a){e.user={username:"",password:""},t.isLogin&&o.path("/"),e.submit=function(){n.post(a+"login",e.user).success(function(){o.path("/"),t.showMsg("登录成功！"),o.reload()}).error(function(e){t.showMsg(e.err||"用户名或密码错误！",{type:"danger"})})}}]),app.config(["$routeProvider",function(e){e.when("/register",{templateUrl:"modules/Account/views/register.html"}).when("/register_pass",{templateUrl:"modules/Account/views/register_pass.html"}).when("/register_result",{templateUrl:"modules/Account/views/register_result.html"})}]),app.controller("RegisterCtrl",["$scope","$rootScope","$http","$location","$q","API_END_POINT",function(e,t,o,n,a,r){e.usernameRegisted=!1,e.emailRegisted=!1,e.cellphoneRegisted=!1,e.user={email:""},e.checkUser=function(){o.post(r+"register?precheck=1",{username:e.user.username,password:"9999999999",email:"9999999999",cellphone:"9999999999"}).success(function(){e.usernameRegisted=!1}).error(function(){e.usernameRegisted=!0})},e.checkEmail=function(){o.post(r+"register?precheck=1",{username:"9999999999",password:"9999999999",email:e.user.email,cellphone:"9999999999"}).success(function(){e.emailRegisted=!1}).error(function(){e.emailRegisted=!0})},e.checkCellphone=function(){o.post(r+"register?precheck=1",{username:"9999999999",password:"9999999999",email:e.user.email,cellphone:"9999999999"}).success(function(){e.cellphoneRegisted=!1}).error(function(){e.cellphoneRegisted=!0})},e.submit=function(){o.post(r+"register?precheck=1",{username:e.user.username,password:"9999999999",email:"9999999999",cellphone:"9999999999"}).success(function(){o.post(r+"register?precheck=1",{username:"9999999999",password:"9999999999",email:e.user.email,cellphone:"9999999999"}).success(function(){o.post(r+"register?precheck=1",{username:"9999999999",password:"9999999999",email:"9999999999",cellphone:e.user.cellphone}).success(function(){t.done=!1,o.post(r+"register",e.user,{withCredentials:!0}).success(function(){t.done=!0,t.showMsg("注册成功！"),t.register_email=e.user.email,n.path("/register_pass"),$(".form-horizontal").reset()}).error(function(e){t.done=!0,t.showMsg(e.err||"illegal request",{type:"danger"})})}).error(function(){t.showMsg("手机号码已被注册！")})}).error(function(){t.showMsg("email已被注册！")})}).error(function(){t.showMsg("用户名已被注册")})},e.toLogin=function(){n.path("/login")},e.tomail=function(e){var t=e.split("@")[1];window.open(-1!=t.indexOf("gmail")?"http://mail.google.com":-1!=t.indexOf("hotmail")||-1!=t.indexOf("msn")?"http://mail.live.com":"http://mail."+t)},e.phoneNumberPattern=function(){var t=/^\d{3,4}-?\d{7,9}$/;return{test:function(o){return e.requireTel===!1?!0:t.test(o)}}}()}]),app.config(["$routeProvider",function(e){e.when("/personal",{templateUrl:"modules/Account/views/personal.html"}).when("/entinfo",{templateUrl:"modules/Account/views/ent.html"}).when("/password",{templateUrl:"modules/Account/views/password.html"}).when("/config",{templateUrl:"modules/Account/views/config.html"})}]),app.controller("UserInfoCtrl",["$scope","$rootScope",function(e,t){e.submit=function(){t.ajax({method:"PUT",url:"profile",data:t.sessionuser,success:function(){t.showMsg("修改成功!",{time:500})}})}}]),app.controller("WhMemberCtrl",["$scope","$http","API_END_POINT","$rootScope",function(e,t,o,n){e.whmember=n.whmember,void 0==e.whmember&&t.get(o+"whmember").success(function(t){if(void 0==t){var o=n.sessionuser,a=n.enterprise;t={name:o.name,entname:a.name,phone:o.phone}}e.whmember=t}).error(function(t){var o=n.sessionuser,a=n.enterprise;t={name:o.name,entname:a.name,phone:o.phone},e.whmember=t}),e.submitWhMember=function(){var a=e.whmember.member_id;void 0==a?t.post(o+"whmember",e.whmember).success(function(t){n.showMsg("修改成功",{time:500}),e.whmember.member_id=t.member_id}).error(function(){}):t.put(o+"whmember",e.whmember).success(function(){n.showMsg("修改成功",{time:500})}).error(function(){})}}]),app.controller("passwordCtrl",["$scope","$rootScope","$http","API_END_POINT",function(e,t,o,n){e.submitPassword=function(){return e.new_password1!=e.new_password2?void alert("两次密码输入不一样"):void o.put(n+"profile/password",{old_password:e.old_password,password:e.new_password1}).success(function(){t.open("修改成功!")}).error(function(){t.open("修改失败,原密码错误!")})}}]),app.controller("EntInfoCtrl",["$scope","$http","API_END_POINT","$rootScope",function(e,t,o,n){e.enterprise=n.enterprise;var a=[{name:"安全、防护"},{name:"办公、文教"},{name:"包装"},{name:"传媒、广电"},{name:"代理"},{name:"电工电器"},{name:"电子元器件"},{name:"二手设备转让"},{name:"纺织、皮革"},{name:"服饰"},{name:"服装"},{name:"化工"},{name:"环保"},{name:"机械及行业设备"},{name:"加工"},{name:"家居用品"},{name:"家用电器"},{name:"建筑、建材"},{name:"交通运输"},{name:"精细化学品"},{name:"库存积压"},{name:"礼品、工艺品、饰品"},{name:"能源"},{name:"农业"},{name:"汽摩及配件"},{name:"商务服务"},{name:"食品、饮料"},{name:"数码、电脑"},{name:"通信产品"},{name:"玩具"},{name:"五金、工具"},{name:"项目合作"},{name:"橡塑"},{name:"冶金矿产"},{name:"医药、保养"},{name:"仪器仪表"},{name:"印刷"},{name:"运动、休闲"},{name:"照明工业"},{name:"纸业"},{name:"原材料"},{name:"安防"},{name:"加工定制"},{name:"物流招聘"},{name:"展会广告"}],r=[{name:"生产加工"},{name:"经营批发"},{name:"招商代理"},{name:"商业服务"},{name:"其它"}],s=[{name:"个人用户"},{name:"企业单位"},{name:"个体经营"},{name:"事业单位或者团体"}];e.industryOption=a,e.businessTypeOption=r,e.entTypeOption=s,e.industrySelect="展会广告",void 0==e.enterprise&&t.get(o+"enterprise").success(function(t){e.enterprise=t}).error(function(){}),e.tabs=[{title:"公司简介",content:"modules/Account/views/enterpriseinfo.html"},{title:"技术实力",content:"modules/Account/views/technic.html"},{title:"网络工商标识",content:"modules/Account/views/gsbs.html"}],e.navType="pills",e.openDateTimePick=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.editorOptions={language:"zh-cn"},t.get(o+"ap").success(function(t){e.technic=t}).error(function(){}),e.submitTechnic=function(){n.ajax({method:"PUT",url:"ap",data:e.technic,success:function(){n.open("修改成功")}})},e.submitGsbs=function(){n.ajax({method:"PUT",url:"enterprise",data:e.enterprise,success:function(){n.enterprise=e.enterprise,n.open("修改成功")}})},e.submitInfo=function(){n.ajax({method:"PUT",url:"enterprise",data:e.enterprise,success:function(){n.enterprise=e.enterprise,n.open("修改成功")}})},e.submitEnt=function(){n.ajax({method:"PUT",url:"enterprise",data:e.enterprise,success:function(){n.enterprise=e.enterprise,n.open("修改成功")}})},e.openFileDialog=function(){return n.openFileDialog(function(t){e.enterprise.logo=t[0].server_path,n.enterprise.logo=t[0].server_path}),!1}}]),app.config(["$routeProvider",function(e){e.when("/news_cate",{templateUrl:"modules/News/views/news_cate.html"}).when("/news_list",{templateUrl:"modules/News/views/news_list.html"}).when("/news_add",{templateUrl:"modules/News/views/news_add.html"})}]);var newsCates=function(e){var t=[];return Est.each(e,function(e){"00"===e.grade&&t.push(e)}),Est.bulidSubNode(t,e),t};app.controller("NewsCateCtrl",["$scope","$rootScope","$http","$modal","$log","API_END_POINT","$q","NewsCategoryFactory",function(e,t,o,n,a,r,s,i){var c=["category_id","belong_id","name","cdesc","grade","isroot","isdisplay","state","image","key","alias","sort","seo_title","seo_keywords","seo_description"],l=0;e.cates=[],e.list=[],e.selectedItem={},e.isChange=!1,e.options=t.NestedSortableOption(e,"category_id","belong_id","grade",d);var u=function(e,o){return e.hasChild?void t.open("请先删除子分类！ 如果无子分类却删除不了　请刷新页面再次尝试删除",function(){},{ok:"确定",cancel:"关闭"}):void t.open("是否删除?",function(){i.del(e).then(function(){var e=o.$index;e>-1&&o.sortableModelValue.splice(e,1)[0],t.addToStatic()})})},d=function(e,t){var o=[];return Est.each(e,function(e){var t=parseInt(e.sort);e.sort=t,t>l&&(l=t),"00"===e.grade&&o.push(e)}),t&&(o=Est.sortBy(o,function(e){return e.sort}),e=Est.sortBy(e,function(e){return e.sort})),Est.bulidSubNode(o,e),o};e.addCategory=function(e,o){i.save(e).then(function(e){e.cates=[],e.hasChild=!1,t.addToStatic(),"function"==typeof o&&o.call(null,e)})},i.query().then(function(t){l=t.length,e.cates=d(t),e.list=t,0==l&&e.addCategory({belong_id:"/",name:"默认分类",cdesc:"默认分类",isroot:"01",grade:"00",sort:++l},function(t){var o=s.defer();return e.list.push(t),e.cates=d(e.list),o.promise})}),e.add=function(o,r){var s="00",u=null,d=null;if("undefined"===Est.typeOf(o))s="01",d="00",u="/";else if(u=o.category_id,d=Est.pad(parseInt(o.grade,10)+1,2,"0",!1,10),"04"===d)return;var p=n.open({templateUrl:"modules/News/views/news_cate_add.html",controller:["$scope","$modalInstance","category",function(e,o,n){e.category=n,t.modalInit(e,o,e.category)}],resolve:{category:function(){return{belong_id:u,name:"",cdesc:"",isroot:s,grade:d,sort:++l}}}});return p.result.then(function(n){var a=Est.pick(n,c);i.save(a).then(function(n){if(n.cates=[],"undefined"===Est.typeOf(o))n.hasChild=!1,e.cates.push(n);else{var a=r.itemData();a.cates.push(n),a.hasChild=!0}e.list.push(n),t.showMsg("添加成功!"),t.addToStatic()})},function(){a.info("NewsCateCtrl -> add: "+new Date)}),!1},e.edit=function(e){var o=n.open({templateUrl:"modules/News/views/news_cate_add.html",controller:["$scope","$modalInstance","category",function(e,o,n){e.category=n,t.modalInit(e,o,e.category)}],resolve:{category:function(){var t=s.defer();return i.detail(e.category_id).then(function(e){t.resolve(e)},function(){t.reject()}),t.promise}}});return o.result.then(function(o){var n=Est.pick(o,c);i.save(n).then(function(){e.name=o.name,e.isdisplay=o.isdisplay,t.showMsg("修改成功!"),t.addToStatic()})}),!1},e.del=function(e,t){return u(e,t),!1},e.seo=function(e){var o=n.open({templateUrl:"modules/News/views/news_cate_seo.html",controller:["$scope","$modalInstance","category",function(e,o,n){e.category=n,t.modalInit(e,o,e.category)}],resolve:{category:function(){var t=s.defer();return i.detail(e.category_id).then(function(e){t.resolve(e)}),t.promise}}});return o.result.then(function(e){var o=Est.pick(e,c);i.save(o).then(function(){t.showMsg("修改成功!"),t.addToStatic()})}),!1},e.display=function(e){e.isdisplay="1"===e.isdisplay?"0":"1";var o=Est.pick(e,c);i.save(o).then(function(){t.addToStatic()})},e.updateSort=function(e){var o=Est.pick(e,c);i.save(o).then(function(){t.addToStatic()})},e.moveUp=function(t,o,n){if(!o){var a=t-1,r=n.grade||"null",s=n.category_id;if("00"==n.grade)Est.arrayExchange(e.cates,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o)}});else{for(t=Est.findIndex(e.list,function(e){return e.category_id==s}),a=t-1;e.list[a].grade!==r&&a>0;)a--;Est.arrayExchange(e.list,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o),e.cates=d(e.list,!0)}})}}},e.moveDown=function(t,o,n){if(!o){var a=t+1,r=n.grade||"null",s=n.category_id,i=e.list.length-1;if("00"==n.grade)Est.arrayExchange(e.cates,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o)}});else{for(t=Est.findIndex(e.list,function(e){return e.category_id==s}),a=t+1;e.list[a].grade!==r&&i>a;)a++;Est.arrayExchange(e.list,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o),e.cates=d(e.list,!0)}})}}}}]),app.controller("NewsAddCtrl",["$scope","$rootScope","$location","$http","API_END_POINT","$q","$modal","NewsFactory","NewsCategoryFactory",function(e,t,o,n,a,r,s,i,c){e.add_page=!1,e.thisPageFlag=!1,e.tabs=[{title:"高级选项",content:"modules/News/views/news_advance.html"},{title:"搜索引擎优化",content:"modules/News/views/news_seo.html"}],e.navType="pills";var l=function(t){t||(e.news={type:{}},e.dialog_show=!1,e.add_page=!0,e.news.add_time=Est.dateFormat(new Date,"yyyy-MM-dd"))},u=o.search().news_id;if(e.news)l(!0);else if(u){var d=r.defer();i.detail(u).then(function(t){t.thumbnail_path=pic_resize(t.pic_path,5),t.dialog_show=!0,e.news=t,l(!0),d.resolve(t)})}else l(!1);e.addCategory=function(e,o){c.save(e).then(function(e){e.cates=[],e.hasChild=!1,"function"==typeof o&&o.call(null,e),t.addToStatic()})},e.initCategory=function(t){e.cates=[];var o=Est.bulidTreeNode(t,"grade","00",{});e.cates=Est.bulidSelectNode(o,0,{name:"name"})};var p=function(){c.query().then(function(t){e.initCategory(t),0==t.length&&e.addCategory({belong_id:"/",name:"默认分类",cdesc:"默认分类",isroot:"01",grade:"00",sort:1},function(o){var n=r.defer();return t.push(o),e.initCategory(t),n.promise})})};p(),e.thisPage=function(){e.thisPageFlag=!0},e.submit=function(){e.news.update_time=Est.dateFormat(new Date,"yyyy-MM-dd"),e.news.imagenews=e.news.imagenews?"01":"02",e.news.topnews=e.news.topnews?"01":"00",e.add_page?i.save(e.news).then(function(o){t.staticPage("news_detail",o.news_id),t.showMsg("添加成功!"),t.addToStatic(),e.thisPageFlag?e.thisPageFlag=!1:t.locationUrl("/news_list","新闻列表")},function(){t.showMsg("操作失败!")}):i.save(e.news).then(function(){t.staticPage("news_detail",e.news.news_id),t.showMsg("保存成功!"),e.ok(e.news),t.addToStatic()},function(){t.showMsg("保存失败!")})},e.openFileDialog=function(){return t.openFileDialog(function(t){e.news.pic_path=t[0].server_path,e.news.thumbnail_path=t[0].thumbnail_path}),!1},e.appendPicDialog=function(){return t.openFileDialog(function(t){e.news.photos.push(t[0])}),!1},e.photo_delete=function(t,o,n){e.news.photos.splice(o,1),n.stopPropagation()},e.photo_hover=function(e){return e.show_tool=!e.show_tool},e.photo_move=function(t,o,n,a){var r=null;0==n?(r=e.news.photos[o],e.news.photos.splice(o,1),e.news.photos.splice(o-1,0,r)):(r=e.news.photos[o],e.news.photos.splice(o,1),e.news.photos.splice(o+1,0,r)),a.stopPropagation()},e.cate_manage=function(){var o=s.open({templateUrl:"modules/News/views/news_cate.html",controller:["$scope","$modalInstance","cates",function(e,o,n){e.cates=n,e.dialog_show=!0,t.modalInit(e,o,e.cates)}],resolve:{cates:function(){return[]}}});o.result.then(function(t){e.cates=t},function(){p()})}}]),app.controller("NewsCtrl",["$scope","$rootScope","$http","API_END_POINT","$q","$filter","ngTableParams","$modal","NewsCategoryFactory","NewsFactory",function(e,t,o,n,a,r,s,i,c,l){e.predicate="sort",e.reverse=!1,e.checkAll=!1,e.show_header=!0,e.navType="pills",e.search_cate="",e.search_key="",e.sortType=-1,e.checkAllFn=function(){e.checkAll=!e.checkAll},c.query().then(function(t){e.cates=[],e.cates=Est.bulidSelectNode(newsCates(t),0,{name:"name"})}),e.tableParams=new s({page:1,count:10},{total:0,getData:function(t,o){l.query({page:o.page(),per_page:o.count()}).then(function(n){e.news_list=n.data;var a=o.filter()?r("filter")(e.news_list,o.filter()):e.news_list,s=o.sorting()?r("orderBy")(a,o.orderBy()):a;o.total(n.count),t.resolve(s)})},$scope:{$data:{}}}),e.toSearch=function(){l.query({category:e.search_cate,title:e.search_key}).then(function(t){e.news_list=t.data})},e.news_del=function(o){t.open("是否删除?",function(){l.del(o).then(function(){t.showMsg("删除成功！",{time:500}),e.tableParams.reload()},function(){t.showMsg("操作失败！",{time:500})})})},e.news_cate_change=function(e){l.save(e).then(function(){e.category,t.addToStatic()})},e.set_top=function(e){e.topnews||(e.topnews="00"),e.topnews="01"==e.topnews?"00":"01",l.save(e,{topnews:e.topnews}).then(function(){t.showMsg("设置成功"),t.addToStatic()})};var u=Array.prototype.indexOf?function(e,t){return t.indexOf(e)}:function(e,t){for(var o=t.length;o--;)if(t[o]===e)return o;return-1};e.sorts=function(){var t=a.defer(),o=[],n=[];return angular.forEach(e.news_list,function(e){-1===u(e.name,o)&&(o.push(e.name),n.push({id:e.name,title:e.name}))}),t.resolve(n),t},e.setSort=function(e){t.ajax({method:"PUT",url:"news/"+e.news_id,data:{sort:e.sort},success:function(){t.showMsg("修改成功！")}})},e.sortByColum=function(t){e.sortType=-1===e.sortType?1:-1,e.news_list=Est.sortBy(e.news_list,function(e){return"sort"===t?parseInt(e[t],10):e[t]}),-1===e.sortType&&e.news_list.reverse()},e.news_view=function(o){var n=i.open({templateUrl:"modules/News/views/news_add.html",controller:["$scope","$modalInstance","news",function(e,o,n){e.news=n,t.modalInit(e,o,e.news)}],windowClass:"news-detail-dialog",resolve:{news:function(){var e=a.defer();return l.detail(o).then(function(t){t.thumbnail_path=pic_resize(t.pic_path,5),t.dialog_show=!0,e.resolve(t)},function(){e.reject()}),e.promise}}});n.result.then(function(){e.tableParams.reload()},function(){})},e.seo_edit=function(o){var n=i.open({templateUrl:"modules/News/views/news_seo.html",controller:e.news,resolve:{news:function(){var e=a.defer();return l.detail(o).then(function(t){t.show_header=!0,t.show_btn=!0,t.dialog_show=!0,e.resolve(t)},function(){e.reject()}),e.promise}}});n.result.then(function(e){l.save(e).then(function(){t.showMsg("修改成功！"),t.addToStatic()})})},e.publish=function(e){t.showMsg("正在发布...",{time:1e6}),t.staticPage("news",e.news_id).then(function(){t.showMsg("发布 "+e.title+" 完成")},function(){t.showMsg("发布失败， 请稍后再试")})},e.to_wwy=function(e){var r=i.open({templateUrl:"modules/Wwy/views/wwy_edit.html",controller:["$scope","$modalInstance","wwy",function(e,t,o){e.wwy=o,e.msg1=!0,e.ok=function(){e.wwy.sharepic=$(".pic_path").val(),t.close(e.wwy)},e.cancel=function(){t.dismiss("cancel")}}],windowClass:"product-detail-dialog",resolve:{wwy:function(){var o=a.defer();return l.detail(e).then(function(e){o.resolve({title:e.title,phone:t.sessionuser.cellphone,content:e.content,sharepic:e.pic_path,isforward:"1",dialog_show:!0})},function(){o.reject()}),o.promise}}});r.result.then(function(e){var a=$("input[name='msgctrl']:checked"),r="";a.each(function(){r+=$(this).val()+","}),r.length>0&&(","==r.substring(r.length-1,r.length)&&(r=r.substring(0,r.length-1)),e.msgctrl=r),o.post(n+"wwy",e).success(function(){t.showMsg("微网页添加成功!")}).error(function(){})},function(){})},e.checkboxes={checked:!1,items:{}},e.$watch("checkboxes.checked",function(t){angular.forEach(e.users,function(o){angular.isDefined(o.id)&&(e.checkboxes.items[o.id]=t)})}),e.$watch("checkboxes.items",function(){if(e.users){var t=0,o=0,n=e.users.length;angular.forEach(e.users,function(n){t+=e.checkboxes.items[n.id]||0,o+=!e.checkboxes.items[n.id]||0}),(0==o||0==t)&&(e.checkboxes.checked=t==n),angular.element(document.getElementById("select_all")).prop("indeterminate",0!=t&&0!=o)}},!0),e.changeSelection=function(){},e.$watch("currentPage",function(t){e.tableParams.page(t)}),e.moveUp=function(t,o){o||Est.arrayExchange(e.news_list,t,t-1,{column:"sort",callback:function(t,o){e.setSort(t),e.setSort(o)}})},e.moveDown=function(t,o){o||Est.arrayExchange(e.news_list,t,t+1,{column:"sort",callback:function(t,o){e.setSort(t),e.setSort(o)}})}}]),app.config(["$routeProvider",function(e){e.when("/product_cate",{templateUrl:"modules/Product/views/product_cate.html"}).when("/product_list",{templateUrl:"modules/Product/views/product_list.html"}).when("/product_add",{templateUrl:"modules/Product/views/product_add.html"}).when("/product_tag_add",{templateUrl:"modules/Product/views/product_tag_add.html"}).when("/product_tag_list",{templateUrl:"modules/Product/views/product_tag_list.html"}).when("/product_upload_excel",{templateUrl:"modules/Product/views/product_upload_by_xls.html"})}]);var productCates=function(e){var t=[],o=Est.sortBy(e,function(e){return e.sort});return Est.each(o,function(e){"01"===e.grade&&t.push(e)}),Est.bulidSubNode(t,e),t},ProCateAddModelInit=function(e,t,o,n){e.category=n,e.ok=function(){t.close(e.category)},e.cancel=function(){t.dismiss("cancel")},e.openFileDialog=function(){return o.openFileDialog(function(t){e.category.image=t[0].server_path}),!1},e.removePic=function(){e.category.image=null}},ProModelInit=function(e,t,o){e.product=o,e.ok=function(){e.product.new_cates=e.new_cates||"",t.close(e.product)},e.cancel=function(){t.dismiss("cancel")}},ProSeoModelInit=function(e,t,o){e.product=o,e.ok=function(){t.close(e.product)},e.cancel=function(){t.dismiss("cancel")}},CateModelInit=function(e,t,o){e.cates=o,e.dialog_show=!0,e.ok=function(){t.close(e.cates)},e.cancel=function(){t.dismiss(e.cates)}};app.controller("ProductUploadCtrl",["$scope","$rootScope","$http","API_END_POINT",function(e,t,o,n){e.file_path="",e.albumId="",e.file_desc="",e.btn_is_true=!0;var a=[{name:"album_id",value:e.albumId}];e.upload_opts={autoUpload:!0,formData:a,done:function(t,o){e.file_path=o.result[0].server_path,e.filename=o.result[0].filename,e.att_id=o.result[0].att_id},fileuploaddone:function(){alert("ss")}},e.doupload=function(){return""==e.file_path?void alert("请先上传excel"):(e.btn_is_true=!1,void o.post(n+"productUploadByExcel",{file_path:e.file_path}).success(function(){o.post(n+"productExcelDel",{file_path:e.file_path,att_id:e.att_id}).success(function(){}).error(function(){}),t.showMsg("上传成功!"),e.file_path="",e.filename="",e.att_id="",e.btn_is_true=!0}).error(function(){alert("error"),e.file_path="",e.filename="",e.att_id="",e.btn_is_true=!0}))}}]),app.controller("ProductCtrl",["$scope","$rootScope","$http","API_END_POINT","$q","$filter","ngTableParams","$modal","ProductFactory","ProductTagFactory",function(e,t,o,n,a,r,s,i,c,l){e.search={},e.predicate="sort",e.tempValue="",e.sortType=-1,e.reverse=!1,e.checkAll=!1,e.show_header=!0,e.API_END_POINT=n,e.product_result_data=[],e.checkAllFn=function(){e.checkAll=!e.checkAll},e.sort={sortingOrder:"sort",reverse:!1};var u=c.query();u.then(function(o){e.product_result_data=o,e.tableParams=new s({page:1,count:10,filter:{name:t.search_key,prodtype:"",category:"",ads:"",type:""},sorting:{sort:"desc"}},{total:e.product_result_data.length,getData:function(t,o){var n=o.filter()?r("filter")(e.product_result_data,o.filter()):e.product_result_data;e.productlist=n.slice((o.page()-1)*o.count(),o.page()*o.count()),o.total(n.length),t.resolve(e.productlist)}})},function(){e.productlist={error:"没有产品！"}}),e.changePerPage=function(t){e.params.count(t)},e.refreshTable=function(){c.query().then(function(t){e.product_result_data=t,e.tableParams.reload()})},e.product_del=function(o,n){t.open("是否删除?",function(){var a=e.tableParams.$params.page,r=e.tableParams.$params.count,s=n,i=(a-1)*r+s;c.del(o).then(function(){t.showMsg("删除成功！",1e3),del_index_by_id(e,e.productlist[n].product_id),e.productlist.splice(n,1),e.product_result_data.splice(i,1),t.addToStatic()},function(){t.showMsg("删除失败！")})})},e.products_del=function(){var o=[],n=[];if(confirm("确定要删除吗？")){if($(".checkProducts").each(function(){1==this.checked&&(o.push($(this).attr("fieldValue")),n.push($(this).attr("indexValue")))}),0==o.length)return void t.showMsg("您还未选中你要删除的产品！");for(var a=0;a<o.length;a++){var r=e.tableParams.$params.page,s=e.tableParams.$params.count,i=parseInt(n[a]),l=(r-1)*s+i-a,u=0>i-a?0:i-a;c.del(o[a]).then(function(){t.addToStatic()},function(){t.showMsg("删除失败！")}),del_index_by_id(e,e.product_result_data[l].product_id),e.productlist.splice(u,1)}t.showMsg("删除成功！"),t.edited=!0}},e.updateAllCategory=function(){var a=[];if($(".checkProducts").each(function(){1==this.checked&&a.push($(this).attr("fieldValue"))}),0==a.length)return void t.showMsg("您还未选中你要修改的产品！",{type:"danger"});var r=i.open({templateUrl:"modules/Product/views/product_category.html",controller:["$scope","$modalInstance","$http","API_END_POINT",function(e,t,o,n){o.get(n+"product/category").success(function(t){e.cates=[];var o=productCates(t),n=function(t,o){var a=o;0==a&&(e.cates=[]),Est.each(t,function(t){for(var r="",s=0;a>s;s++)r+="　";r+="|-",t.name=r+t.name,e.cates.push(t),t.hasChild&&n(t.cates,o=a+2)})};n(o,0)}).error(function(){}),e.ok=function(e){t.close(e)},e.cancel=function(){t.dismiss("cancel")}}],resolve:{ids:function(){return{ids:a}}}});r.result.then(function(r){for(var s in a)update_category_by_id(e,n,o,a[s],r);t.showMsg("修改成功!")},function(){})};e.set_broadcast=function(e){e.broadcast||(e.proadcast="00"),e.broadcast="01"==e.broadcast?"00":"01",t.ajax({method:"PUT",url:"product/"+e.product_id,data:{broadcast:e.broadcast}})};var d=Array.prototype.indexOf?function(e,t){return t.indexOf(e)}:function(e,t){for(var o=t.length;o--;)if(t[o]===e)return o;return-1};e.sorts=function(){var t=a.defer(),o=[],n=[];return angular.forEach(e.products,function(e){-1===d(e.name,o)&&(o.push(e.name),n.push({id:e.name,title:e.name}))}),t.resolve(n),t},e.sortByColum=function(t){e.sortType=-1===e.sortType?1:-1,e.product_result_data=Est.sortBy(e.product_result_data,function(e){return"sort"===t?parseInt(e[t],10):e[t]}),-1===e.sortType&&e.product_result_data.reverse(),e.tableParams.reload()},e.setSort=function(e){t.ajax({method:"PUT",url:"product/"+e.product_id,data:{sort:e.sort},success:function(){t.showMsg("修改成功!")}})},e.product_view=function(o){var n=i.open({templateUrl:"modules/Product/views/product_add.html",controller:["$scope","$modalInstance","product",function(e,t,o){e.product=o,e.ok=function(){e.product.new_cates=e.new_cates||"",t.close(e.product)},e.cancel=function(){t.dismiss("cancel")}}],windowClass:"product-detail-dialog",resolve:{product:function(){var e=a.defer();return c.detail(o.product_id).then(function(t){t.thumbnail_path=pic_resize(t.pic_path,5),t.dialog_show=!0,e.resolve(t)},function(t){e.reject(t)}),e.promise}}});n.result.then(function(o){var n=o.new_cates.length>0?","+o.new_cates.toString(","):"";o.category=o.category+n,o.detail3=Est.arrayToObject(o.paramValues,"name","value"),c.save(o).then(function(){t.showMsg("修改成功!",{time:500}),t.addToStatic(),e.refreshTable()},function(){t.showMsg("修改失败!")})},function(){})},e.checkboxes={checked:!1,items:{}},e.$watch("checkboxes.checked",function(t){angular.forEach(e.users,function(o){angular.isDefined(o.id)&&(e.checkboxes.items[o.id]=t)})}),e.$watch("checkboxes.items",function(){if(e.users){var t=0,o=0,n=e.users.length;angular.forEach(e.users,function(n){t+=e.checkboxes.items[n.id]||0,o+=!e.checkboxes.items[n.id]||0}),(0==o||0==t)&&(e.checkboxes.checked=t==n),angular.element(document.getElementById("select_all")).prop("indeterminate",0!=t&&0!=o)}},!0),e.seo_edit=function(e){var o=i.open({templateUrl:"modules/Product/views/product_seo.html",controller:ProSeoModelInit,resolve:{product:function(){var t=a.defer();return c.detail(e.product_id).then(function(e){e.show_header=!0,e.show_btn=!0,e.dialog_show=!0,t.resolve(e)}),t.promise}}});o.result.then(function(e){c.save(e).then(function(){t.showMsg("修改成功!"),t.addToStatic()})})},e.changeSelection=function(e,t){console.info(e+";;"+t)},e.navType="pills",e.setTempValue=function(t){e.tempValue=t},e.moveUp=function(t,o){o||Est.arrayExchange(e.productlist,t,t-1,{column:"sort",callback:function(t,o){e.setSort(t),e.setSort(o),update_sort_by_id(e,t.product_id,t.sort),update_sort_by_id(e,o.product_id,o.sort,!0)}})},e.moveDown=function(t,o){o||Est.arrayExchange(e.productlist,t,t+1,{column:"sort",callback:function(t,o){e.setSort(t),e.setSort(o),update_sort_by_id(e,t.product_id,t.sort),update_sort_by_id(e,o.product_id,o.sort,!0)}})},e.insertSort=function(t){var o=e.tempValue,n=t.product_id;t.product_id=o;var a=Est.findIndex(e.product_result_data,function(e){return e.product_id==o}),r=Est.findIndex(e.product_result_data,function(e){return e.product_id==n});Est.arrayInsert(e.product_result_data,a,r,{column:"sort",callback:function(t){Est.each(t,function(t){e.setSort(t),update_sort_by_id(e,t.product_id,t.sort)})}}),e.product_result_data=Est.sortBy(e.product_result_data,function(e){return-1*parseInt(e.sort)}),e.tableParams.reload()},e.delTag=function(e,t,o){l.delProTag(e,t).then(function(){Est.removeAt(o,Est.findIndex(o,{tag_id:t}))})},e.publish=function(e){t.showMsg("正在发布...",{time:1e6}),t.staticPage("product",e.product_id).then(function(){t.showMsg("发布 "+e.name+" 完成")},function(){t.showMsg("发布失败， 请稍后再试")})}}]),app.controller("ProductCategoryCtrl",["$scope","$http","API_END_POINT",function(e,t,o){t.get(o+"product/category").success(function(t){e.cates=[];var o=productCates(t),n=function(t,o){var a=o;0==a&&(e.cates=[]),Est.each(t,function(t){for(var r="",s=0;a>s;s++)r+="　";r+="|-",t.name=r+t.name,e.cates.push(t),t.hasChild&&n(t.cates,o=a+2)})};n(o,0)}).error(function(){})}]),app.controller("ProductAddCtrl",["$scope","$rootScope","$http","API_END_POINT","$q","$modal","$location","ProductFactory","ProductTagFactory","ProductCategoryFactory",function(e,t,o,n,a,r,s,i,c,l){e.tabs=[{title:"高级选项",content:"modules/Product/views/product_advance.html"},{title:"搜索引擎优化",content:"modules/Product/views/product_seo.html"}],e.add_page=!1,e.agrs={},e.thisPageFlag=!1,e.navType="pills",e.types=[{type:"NM",name:"普通"},{type:"NW",name:"新品"},{type:"CP",name:"精品"}],e.loginViews=[{val:"0",name:"访问者可见"},{val:"1",name:"登录后可见"}],e.adss=[{val:"1",name:"广告产品"},{val:"0",name:"普通产品"}];var u=function(t){t?(e.new_cates=e.product.category.split(","),e.product.category=e.new_cates[0],e.product.paramValues=Est.arrayFromObject(JSON.parse(e.product.detail3),"name","value"),e.new_cates.shift()):(e.product={type:{}},e.product.paramValues=[],e.new_cates=[],e.dialog_show=!1,e.add_page=!0,e.product.type=e.types[0].type,e.product.login_view=e.loginViews[0].val,e.product.ads=e.adss[1].val,e.product.detail_title1="产品服务",e.product.detail_title2="产品功能",e.product.photos=[])},d=s.search().product_id;e.product?u(!0):d?i.detail(d).then(function(t){t.thumbnail_path=pic_resize(t.pic_path,5),t.dialog_show=!0,e.product=t,u(!0)}):u(!1),e.addCategory=function(e,t){l.save(e).then(function(e){e.cates=[],e.hasChild=!1,"function"==typeof t&&t.call(null,e)})},e.initCategory=function(t){e.cates=[];var o=productCates(t),n=function(t,o){var a=o;Est.each(t,function(t){for(var r="",s=0;a>s;s++)r+="　";r+="|-",t.name=r+t.name,e.cates.push(t),t.hasChild&&n(t.cates,o=a+2)})};n(o,0)};var p=function(){l.query().then(function(t){e.initCategory(t),0==t.length&&e.addCategory({belong_id:"/",name:"默认分类",cdesc:"默认分类",isroot:"01",grade:"01",sort:1},function(o){var n=a.defer();return t.push(o),e.initCategory(t),n.promise})})};p(),e.cate_add=function(){e.new_cates.push("")},e.new_cate_del=function(t){e.new_cates.splice(t,1)},e.change_new_cates=function(t,o){e.new_cates[o]=t},e.thisPage=function(){e.thisPageFlag=!0},e.submit=function(){var o=e.new_cates.length>0?","+e.new_cates.toString(","):"";e.product.category=e.product.category+o,e.product.detail3=Est.arrayToObject(e.product.paramValues,"name","value"),e.add_page?i.save(e.product).then(function(o){t.staticPage("product_detail",o.product_id),t.showMsg("添加成功!"),Est.each(e.tags,function(e){e.checked&&c.saveProTag(o.product_id,e.tag_id)
}),e.thisPageFlag?e.thisPageFlag=!1:t.locationUrl("/product_list","产品管理")},function(){t.showMsg("添加失败!")}):i.save(e.product).then(function(){t.staticPage("product_detail",e.product.product_id),t.showMsg("修改成功!"),e.ok(e.product)},function(){t.showMsg("修改失败!")})},e.openFileDialog=function(){return t.openFileDialog(function(t){e.product.pic_path=t[0].server_path,e.product.thumbnail_path=t[0].thumbnail_path}),!1},e.photo_hover=function(e){return e.show_tool=!e.show_tool},e.photo_delete=function(t,o,n){e.product.photos.splice(o,1),n.stopPropagation()},e.photo_move=function(t,o,n,a){var r=null;0==n?(r=e.product.photos[o],e.product.photos.splice(o,1),e.product.photos.splice(o-1,0,r)):(r=e.product.photos[o],e.product.photos.splice(o,1),e.product.photos.splice(o+1,0,r)),a.stopPropagation()},e.appendPicDialog=function(){return t.openFileDialog(function(t){e.product.photos.push(t[0])}),!1},e.addParams=function(){e.product.paramValues.push({name:"",value:""})},e.param_delete=function(t,o){Est.removeAt(e.product.paramValues,t),o.stopPropagation()},e.param_move=function(t,o,n){var a="0"==o?t-1:t+1;Est.arrayExchange(e.product.paramValues,t,a),n.stopPropagation()},e.cate_manage=function(){var o=r.open({templateUrl:"modules/Product/views/product_cate.html",controller:["$scope","$modalInstance","cates",function(e,o,n){e.cates=n,e.dialog_show=!0,t.modalInit(e,o,e.cates)}],resolve:{cates:function(){return[]}}});o.result.then(function(t){e.cates=t},function(){p()})}}]),app.controller("ProductAddTagCtrl",["$scope","$rootScope","ProductTagFactory",function(e,t,o){o.query().then(function(t){e.tags=t}),o.detail(e.product.product_id).then(function(t){e.proTags=t}),e.isChecked=function(t){return Est.findIndex(e.proTags,{tag_id:t.tag_id})>-1?(t.checked=!0,!0):void 0},e.addTag=function(n){if(n&&n.length>0){var a=Est.findIndex(e.tags,{title:n});if(a>-1)return t.showMsg("此标签已经存在！"),!1;o.save({title:n}).then(function(t){t.checked=!0,e.proTags.push(t),e.tags.push(t),o.saveProTag(e.product.product_id,t.tag_id),e.product.tagName=""})}},e.saveProTag=function(t){t.checked=!t.checked,"undefined"!==Est.typeOf(e.product.product_id)&&(t.checked?o.saveProTag(e.product.product_id,t.tag_id):o.delProTag(e.product.product_id,t.tag_id))}}]),app.controller("ProductCateCtrl",["$scope","$rootScope","$http","$modal","API_END_POINT","$q","ProductCategoryFactory",function(e,t,o,n,a,r,s){var i=0,c=["category_id","belong_id","name","cdesc","grade","isroot","isdisplay","state","image","key","alias","sort","seo_title","seo_keywords","seo_description","adcontent"];e.cates=[],e.list=[],e.selectedItem={},e.isChange=!1,e.options=t.NestedSortableOption(e,"category_id","belong_id","grade",u);var l=function(o){o.hasChild&&t.open("该分类存在子分类，点确定将删除该分类下的所有分类！",function(){},{ok:"确定",cancel:"关闭"}),t.open("是否删除?",function(){s.del(o).then(function(){var n=Est.findIndex(e.list,function(e){return e.category_id==o.category_id});e.list.splice(n,1),e.cates=u(e.list),t.addToStatic()})})},u=function(e,t){var o=[];return Est.each(e,function(e){var t=parseInt(e.sort);e.sort=t,t>i&&(i=t),"01"===e.grade&&o.push(e)}),t&&(o=Est.sortBy(o,function(e){return e.sort}),e=Est.sortBy(e,function(e){return e.sort})),Est.bulidSubNode(o,e),o};e.addCategory=function(e,t){s.save(e).then(function(e){e.cates=[],e.hasChild=!1,"function"==typeof t&&t.call(null,e)})},s.query().then(function(t){i=t.length,e.cates=u(t),e.list=t,0==i&&e.addCategory({belong_id:"/",name:"默认分类",cdesc:"默认分类",isroot:"01",grade:"01",sort:++i},function(t){var o=r.defer();return e.list.push(t),e.cates=u(e.list),o.promise})}),e.add=function(o,a){var r="00",l=null,u=null;if("undefined"==typeof o)r="01",u="01",l="/";else if(l=o.category_id,u=Est.pad(parseInt(o.grade,10)+1,2,"0",!1,10),"05"===u)return;var d=n.open({templateUrl:"modules/Product/views/product_cate_add.html",controller:["$scope","$modalInstance","$rootScope","category",function(e,t,o,n){e.category=n,o.modalInit(e,t,e.category),e.openFileDialog=function(){return o.openFileDialog(function(t){e.category.image=t[0].server_path}),!1},e.removePic=function(){e.category.image=null}}],resolve:{category:function(){return{belong_id:l,name:"",cdesc:"",isroot:r,grade:u,sort:++i}}}});return d.result.then(function(n){var r=Est.pick(n,c);s.save(r).then(function(n){if(n.cates=[],"undefined"==typeof o)n.hasChild=!1,e.cates.push(n);else{var r=a.itemData();r.cates.push(n),r.hasChild=!0}e.list.push(n),t.showMsg("添加成功!"),t.addToStatic()})}),!1},e.edit=function(e){var o=n.open({templateUrl:"modules/Product/views/product_cate_add.html",controller:["$scope","$modalInstance","$rootScope","category",function(e,t,o,n){e.category=n,o.modalInit(e,t,e.category),e.openFileDialog=function(){return o.openFileDialog(function(t){e.category.image=t[0].server_path}),!1},e.removePic=function(){e.category.image=null}}],resolve:{category:function(){var t=r.defer();return s.detail(e.category_id).then(function(e){t.resolve(e)}),t.promise}}});return o.result.then(function(e){var o=Est.pick(e,c);s.save(o).then(function(o){o.name=e.name,o.isdisplay=e.isdisplay,t.showMsg("修改成功!")})},function(){}),!1},e.editPic=function(e){var o=n.open({templateUrl:"modules/Product/views/product_cate_pic.html",controller:["$scope","$modalInstance","$rootScope","category",function(e,t,o,n){e.category=n,o.modalInit(e,t,e.category),e.openFileDialog=function(){return o.openFileDialog(function(t){e.category.image=t[0].server_path}),!1},e.removePic=function(){e.category.image=null}}],resolve:{category:function(){var t=r.defer();return s.detail(e.category_id).then(function(e){t.resolve(e)}),t.promise}}});return o.result.then(function(o){var n=Est.pick(o,c);s.save(n).then(function(){e.image=o.image,t.showMsg("修改成功!")})}),!1},e.editAdPic=function(e){var o=n.open({templateUrl:"modules/Product/views/product_cate_adcontent.html",controller:["$scope","$modalInstance","$rootScope","category",function(e,t,o,n){e.category=n,o.modalInit(e,t,e.category),e.openFileDialog=function(){return o.openFileDialog(function(t){e.category.image=t[0].server_path}),!1},e.removePic=function(){e.category.image=null}}],windowClass:"product-detail-dialog",resolve:{category:function(){var t=r.defer();return s.detail(e.category_id).then(function(e){t.resolve(e)}),t.promise}}});return o.result.then(function(o){var n=Est.pick(o,c);s.save(n).then(function(){e.adcontent=o.adcontent,t.showMsg("修改成功！"),t.addToStatic()})}),!1},e.del=function(e,t){return l(e,t),!1},e.seo=function(e){var o=n.open({templateUrl:"modules/Product/views/product_cate_seo.html",controller:["$scope","$modalInstance","$rootScope","category",function(e,t,o,n){e.category=n,o.modalInit(e,t,e.category),e.openFileDialog=function(){return o.openFileDialog(function(t){e.category.image=t[0].server_path}),!1},e.removePic=function(){e.category.image=null}}],resolve:{category:function(){var t=r.defer();return s.detail(e.category_id).then(function(e){t.resolve(e)}),t.promise}}});return o.result.then(function(e){var o=Est.pick(e,c);s.save(o).then(function(){t.showMsg("修改成功！")})}),!1},e.display=function(e){e.isdisplay="1"===e.isdisplay?"0":"1";var o=Est.pick(e,c);s.save(o).then(function(){},function(){t.showMsg("设置未成功",{type:"danger"})})},e.updateSort=function(e){var t=Est.pick(e,c);s.save(t)},e.moveUp=function(t,o,n){if(!o){var a=t-1,r=n.grade||"null",s=n.category_id;if("01"==n.grade)Est.arrayExchange(e.cates,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o)}});else{for(t=Est.findIndex(e.list,function(e){return e.category_id==s}),a=t-1;e.list[a].grade!==r&&a>0;)a--;Est.arrayExchange(e.list,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o),e.cates=u(e.list,!0)}})}}},e.moveDown=function(t,o,n){if(!o){var a=t+1,r=n.grade||"null",s=n.category_id,i=e.list.length-1;if("01"==n.grade)Est.arrayExchange(e.cates,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o)}});else{for(t=Est.findIndex(e.list,function(e){return e.category_id==s}),a=t+1;e.list[a].grade!==r&&i>a;)a++;Est.arrayExchange(e.list,t,a,{column:"sort",callback:function(t,o){e.updateSort(t),e.updateSort(o),e.cates=u(e.list,!0)}})}}}}]),app.config(["$routeProvider",function(e){e.when("/product_cate_v2",{templateUrl:"modules/Product/views/product_cate_v2.html"})}]),app.controller("ProductCateCtrlV2",["$scope","$rootScope","ProductCategoryFactory",function(e,t,o){var n=0;e.cates=[],e.list=[],e.selectedItem={},e.isChange=!1,e.extend=function(e){e.extend=!e.extend},e.bulidCate=function(e,t){return Est.bulidTreeNode(e,"grade","01",{callback:function(e){e.sort=parseInt(e.sort),e.sort>n&&(n=e.sort)},sortBy:t?"sort":void 0})},o.query().then(function(t){n=t.length,e.cates=e.bulidCate(t),e.list=t,0==n&&e.addCategory({belong_id:"/",name:"默认分类",cdesc:"默认分类",isroot:"01",grade:"01",sort:++n},function(t){var o=$q.defer();return e.list.push(t),e.cates=e.bulidCate(t),o.promise})})}]),app.controller("ProductTagCtrl",["$scope","$rootScope","$http","API_END_POINT","ngTableParams","$modal","ProductTagFactory","$filter",function(e,t,o,n,a,r,s,i){e.checkAllFn=function(){e.checkAll=!e.checkAll};var c=s.query();c.then(function(o){e.product_tag_result_data=o,e.tableParams=new a({page:1,count:10,filter:{title:t.search_key},sorting:{sort:"desc"}},{total:e.product_tag_result_data.length,getData:function(t,o){var n=o.filter()?i("filter")(e.product_tag_result_data,o.filter()):e.product_tag_result_data;e.productTaglist=n.slice((o.page()-1)*o.count(),o.page()*o.count()),o.total(n.length),t.resolve(e.productTaglist)}})},function(){e.productTaglist={error:"没有标签！"}}),e.changePerPage=function(t){e.params.count(t)},e.removeTag=function(o){t.open("是否删除？",function(){var n=Est.findIndex(e.product_tag_result_data,{tag_id:o.tag_id});s.del(o.tag_id).then(function(){t.showMsg("删除成功！"),e.product_tag_result_data.splice(n,1),e.tableParams.reload()})})};var l=function(t){var o=Est.findIndex(e.product_tag_result_data,{title:t});return-1!==o?!0:!1};e.addTag=function(o){var n=o?!0:!1;o=o||{title:""};var a=r.open({templateUrl:"modules/Product/views/product_tag_add.html",controller:["$scope","$modalInstance","tag",function(e,o,n){e.tag=n,t.modalInit(e.tag)}],resolve:{tag:function(){return Est.cloneDeep(o)}}});return a.result.then(function(a){return l(a.title)?void t.open("此标签名称已存在！"):void s.save(a).then(function(r){n?(o=a,t.showMsg("修改成功！")):(e.product_tag_result_data.unshift(r),t.showMsg("添加成功！")),e.refreshTable()})},function(){}),!1},e.refreshTable=function(){s.query().then(function(t){e.product_tag_result_data=t,e.tableParams.reload()})},e.setSort=function(e){o.put(n+"product/tag/"+e.tag_id,{sort:e.sort}).success(function(){t.showMsg("修改成功！")})},e.update_sort_by_id=function(e,t,o,n){Est.filter(e.product_tag_result_data,{tag_id:t})[0].sort=o,n&&(e.product_tag_result_data=Est.sortBy(e.product_tag_result_data,function(e){return-1*parseInt(e.sort)}))},e.moveUp=function(t,o){o||Est.arrayExchange(e.productTaglist,t,t-1,{column:"sort",callback:function(t,o){e.setSort(t),e.setSort(o),e.update_sort_by_id(e,t.tag_id,t.sort),e.update_sort_by_id(e,o.tag_id,o.sort,!0)}})},e.moveDown=function(t,o){o||Est.arrayExchange(e.productTaglist,t,t+1,{column:"sort",callback:function(t,o){e.setSort(t),e.setSort(o),e.update_sort_by_id(e,t.tag_id,t.sort),e.update_sort_by_id(e,o.tag_id,o.sort,!0)}})}}]),app.config(["$routeProvider",function(e){e.when("/supply_list",{templateUrl:"modules/Supply/views/supply_list.html"}).when("/supply_add",{templateUrl:"modules/Supply/views/supply_add.html"})}]),app.controller("supplyCtrl",["$scope’, ‘$rootScope","$http","$modal","API_END_POINT","$q","$filter","ngTableParams","SupplyFatory",function(e,t,o,n,a,r,s,i,c){var l={SE:"供应",BU:"求购",AG:"代理",CO:"合作"};e.types=l,e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.tableParams=new i({page:1,count:10,sorting:{sort:"desc"}},{total:0,getData:function(t,o){c.query({page:o.page(),per_page:o.count()}).then(function(n){var a=n.data;e.supplylist=a;var r=o.filter()?s("filter")(e.supplylist,o.filter()):e.supplylist,i=o.sorting()?s("orderBy")(r,o.orderBy()):r;o.total(n.count),t.resolve(i)})},$scope:{$data:{}}}),e.supply_del=function(o,n){t.open("确定删除？",function(){c.del(o).then(function(){t.showMsg("删除成功!"),e.supplylist.splice(n,1)})},{ok:"确定",cancel:"取消"})},e.edit=function(o){var a=n.open({templateUrl:"modules/Supply/views/supply_add.html",controller:["$scope","$modalInstance","supply_detail",function(e,o,n){e.supply=n,t.modalInit(e,o,e.supply)}],windowClass:"product-detail-dialog",resolve:{supply_detail:function(){var e=r.defer();return c.detail(o).then(function(t){t.dialog_show=!0,e.resolve(t)},function(){e.reject()}),e.promise}}});a.result.then(function(n){c.save(o).then(function(){t.showMsg("修改成功!"),o.title=n.title,e.tableParams.reload()})},function(){})}}]),app.controller("supplyAddCtrl",["$scope","$rootScope","$http","API_END_POINT","SupplyFactory",function(e,t,o,n,a){e.supply||(e.supply={type:"SE"},e.add_page=!0),e.toAdd=function(){a.save(e.supply).then(function(){e.add_page?(t.showMsg("添加成功!"),t.locationUrl("/supply_list","供求管理")):(t.showMsg("修改成功!"),e.ok(e.supply))})}}]),app.config(["$routeProvider",function(e){e.when("/wwy",{templateUrl:"modules/Wwy/views/wwy_list.html"}).when("/wwy_info",{templateUrl:"modules/Wwy/views/wwy_info_list.html"}).when("/wwy_add",{templateUrl:"modules/Wwy/views/wwy_add.html"})}]),app.controller("wwyCtrl",["$scope","$rootScope","$http","$modal","SOURCE_URL","API_END_POINT","$q","$filter","ngTableParams",function(e,t,o,n,a,r,s,i,c){e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.tableParams=new c({page:1,count:10,sorting:{sort:"desc"}},{total:0,getData:function(t,n){o.get(r+"wwy",{withCredentials:!0,params:{page:n.page(),per_page:n.count()}}).success(function(o){for(var r=o.data,s=0;s<r.length;s++){var c=0;$.ajax({url:a+"wwy/"+r[s].wwy_id+"/info",async:!1,success:function(e){if(0!=e.length)for(var t in e)c+=parseInt(e[t].nclick)}}),r[s].nclick=c}e.wwylist=r;var l=n.filter()?i("filter")(e.wwylist,n.filter()):e.wwylist,u=n.sorting()?i("orderBy")(l,n.orderBy()):l;n.total(o.count),t.resolve(u)}).error(function(){})},$scope:{$data:{}}}),e.wwy_id2=function(e){return parseInt(e.replace(/[\D]/g,""))},e.del=function(n,a){confirm("确定删除？")&&o({method:"DELETE",url:r+"wwy/"+n.wwy_id}).success(function(){t.showMsgS("删除成功!"),e.wwylist.splice(a,1)})},e.edit=function(a){var i=n.open({templateUrl:"modules/Wwy/views/wwy_edit.html",controller:["$scope","$modalInstance","wwy",function(e,t,o){e.wwy=o,e.msg1=!0,e.ok=function(){e.wwy.sharepic=$(".pic_path").val(),t.close(e.wwy)},e.cancel=function(){t.dismiss("cancel")}}],windowClass:"product-detail-dialog",resolve:{wwy:function(){if(void 0==a)return null;var e=s.defer();return o.get(r+"wwy/"+a.wwy_id).success(function(t){t.dialog_show=!0,e.resolve(t)}).error(function(){e.reject()}),e.promise}}});i.result.then(function(n){var a=$("input[name='msgctrl']:checked"),s="";a.each(function(){s+=$(this).val()+","}),s.length>0&&(","==s.substring(s.length-1,s.length)&&(s=s.substring(0,s.length-1)),n.msgctrl=s),void 0!=n.wwy_id?o.put(r+"wwy/"+n.wwy_id,n).success(function(){t.showMsg("修改成功!"),n.title=this.wwy.title}).error(function(){}):o.post(r+"wwy",n).success(function(o){t.showMsg("添加成功!"),e.wwylist.unshift(o)}).error(function(){})},function(){})}}]),app.controller("wwyInfoCtrl",["$scope","$http","$location","API_END_POINT","$filter","ngTableParams",function(e,t,o,n,a,r){var s=o.$$search.wwy_id,i=o.$$search.t;e.wwy_title=i,e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.tableParams=new r({page:1,count:10,sorting:{sort:"desc"}},{total:0,getData:function(o,r){t.get(n+"wwy/"+s+"/info",{withCredentials:!0,params:{page:r.page(),per_page:r.count()}}).success(function(t){var n=t;e.infolist=n;var s=r.filter()?a("filter")(e.infolist,r.filter()):e.infolist,i=r.sorting()?a("orderBy")(s,r.orderBy()):s;r.total(t.count),o.resolve(i)}).error(function(){})},$scope:{$data:{}}}),e.returnWwy=function(){o.path("/wwy")}}]),app.controller("wwyAddCtrl",["$scope","$rootScope","$http","$location","API_END_POINT",function(e,t,o,n,a){e.wwy={},e.toAdd=function(){var r=e.wwy,s=$("input[name='msgctrl']:checked"),i="";s.each(function(){i+=$(this).val()+","}),i.length>0&&(","==i.substring(i.length-1,i.length)&&(i=i.substring(0,i.length-1)),r.msgctrl=i),o.post(a+"wwy",r).success(function(){t.showMsg("添加成功!"),n.path("wwy")}).error(function(){})}}]),app.controller("WwyAddModelInit",["$scope","$modalInstance,wwy",function(e,t,o){if(e.wwy=o,void 0==e.wwy)e.wwy={},e.msg1=!1,e.msg2=!1,e.msg3=!1,e.msg4=!1,e.msg5=!1,e.msg6=!1,e.msg7=!1;else{var n=e.wwy.msgctrl;n.indexOf("1")>-1&&(e.msg1=!0),n.indexOf("2")>-1&&(e.msg2=!0),n.indexOf("3")>-1&&(e.msg3=!0),n.indexOf("4")>-1&&(e.msg4=!0),n.indexOf("5")>-1&&(e.msg5=!0),n.indexOf("6")>-1&&(e.msg6=!0),n.indexOf("7")>-1&&(e.msg7=!0)}e.ok=function(){e.wwy.sharepic=$(".pic_path").val(),t.close(e.wwy)},e.cancel=function(){t.dismiss("cancel")}}]),app.config(["$routeProvider",function(e){e.when("/bind",{templateUrl:"modules/Bind/views/bind_list.html"})}]),app.controller("bindCtrl",["$scope","$rootScope","$http","$modal","API_END_POINT","$filter","ngTableParams",function(e,t,o,n,a,r,s){e.reverse=!1,e.checkAll=!1,e.bindlist=[],e.checkAllFn=function(){e.checkAll=!e.checkAll},e.tableParams=new s({page:1,count:10},{total:0,getData:function(t,n){o.get(a+"bind",{withCredentials:!0,params:{page:n.page(),per_page:n.count()}}).success(function(o){e.bindlist=o;var a=n.filter()?r("filter")(e.bindlist,n.filter()):e.bindlist,s=n.sorting()?r("orderBy")(a,n.orderBy()):a;n.total(o.count),t.resolve(s)}).error(function(){})},$scope:{$data:{}}}),e.del=function(n,r){t.open("是否删除?",function(){return"01"==n.state?void t.open("已绑定的域名不能删除,请联系管理员取消绑定"):void o({method:"DELETE",url:a+"bind/"+n.bind_id}).success(function(){t.showMsg("删除成功!"),e.bindlist.splice(r,1)})})},e.add=function(r){var s=n.open({templateUrl:"modules/Bind/views/bind_add.html",controller:["$scope","$modalInstance","bind",function(e,o,n){e.bind=n,e.bind.type="D",t.modalInit(e,o,e.bind)}],resolve:{bind:function(){return{bind_id:r}}}});s.result.then(function(n){return Est.findIndex(e.bindlist,{address:n.address})>0?void t.showMsg("域名不能重复添加！",{type:"danger",time:2e3}):void o.post(a+"bind",n).success(function(o){t.showMsg("添加成功!"),e.bindlist.unshift(o)})},function(){})}}]),app.config(["$routeProvider",function(e){e.when("/cert",{templateUrl:"modules/Certificate/views/cert_list.html"})}]),app.controller("certCtrl",["$scope","$rootScope","$http","$modal","API_END_POINT","$q","$filter","ngTableParams","CertificateFactory",function(e,t,o,n,a,r,s,i,c){e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.refreshTable=function(){c.query({page:e.tableParams.page(),per_page:e.tableParams.count()}).then(function(t){e.certlist=t,e.tableParams.reload()})},e.tableParams=new i({page:1,count:10},{total:0,getData:function(t,o){c.query({page:o.page(),per_page:o.count()}).then(function(n){e.certlist=n.data;var a=o.filter()?s("filter")(e.certlist,o.filter()):e.certlist,r=o.sorting()?s("orderBy")(a,o.orderBy()):a;o.total(n.count),t.resolve(r)})},$scope:{$data:{}}}),e.del=function(o,n){t.open("确定删除？",function(){c.del(o).then(function(){t.showMsg("删除成功!",{time:500}),e.certlist.splice(n,1),t.addToStatic()})})},e.edit=function(o){var a=n.open({templateUrl:"modules/Certificate/views/cert_add.html",controller:["$scope","$modalInstance","cert",function(e,o,n){e.cert=n,n.certificate_id&&(e.cert.server_path=0==n.photos.length?"":n.photos[0].server_path),t.modalInit(e,o,e.cert),e.openFileDialog=function(){return t.openFileDialog(function(t){e.cert.server_path=t[0].server_path,e.cert.mainphoto=t[0].att_id}),!1}}],resolve:{cert:function(){if(o){var e=r.defer();return c.detail(o.certificate_id).then(function(t){e.resolve(t)},function(){e.reject()}),e.promise}return{type:"01"}}}});a.result.then(function(o){c.save(o).then(function(n){o.certificate_id?(t.showMsg("修改成功!",{time:500}),o.name=o.name,o.type=o.type,o.organize=o.organize,e.refreshTable()):(t.showMsg("添加成功!",{time:500}),e.certlist.unshift(n)),n.thumbnail_path=n.server_path,t.addToStatic()})})}}]),app.config(["$routeProvider",function(e){e.when("/recruit",{templateUrl:"modules/Recruit/views/recruit_list.html"})}]),app.controller("RecruitCtrl",["$scope","$rootScope","$http","$modal","API_END_POINT","$q","$filter","ngTableParams","RecruitFactory",function(e,t,o,n,a,r,s,i,c){e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.refreshTable=function(){c.query({page:e.tableParams.page(),per_page:e.tableParams.count()}).then(function(t){e.joblist=t,e.tableParams.reload()})},e.tableParams=new i({page:1,count:10},{total:0,getData:function(t,o){c.query({page:o.page(),per_page:o.count()}).then(function(n){e.joblist=n.data;var a=o.filter()?s("filter")(e.joblist,o.filter()):e.joblist,r=o.sorting()?s("orderBy")(a,o.orderBy()):a;o.total(n.count),t.resolve(r)})},$scope:{$data:{}}}),e.del=function(o,n){t.open("确定删除？",function(){c.del(o).then(function(){t.showMsg("删除成功!",{time:500}),e.joblist.splice(n,1),t.addToStatic()})})},e.add=function(o){var a=n.open({templateUrl:"modules/Recruit/views/recruit_add.html",controller:["$scope","$modalInstance","job",function(e,o,n){e.job=n,t.modalInit(e,o,e.job)}],resolve:{job:function(){return o?o:{}}}});a.result.then(function(o){c.save(o).then(function(n){o.job_id?(t.showMsg("修改成功!",{time:500}),e.refreshTable()):(t.showMsg("添加成功!",{time:500}),e.joblist.unshift(n))})})}}]),app.config(["$routeProvider",function(e){e.when("/submember",{templateUrl:"modules/Customer/views/submember_list.html"}).when("/inquiry",{templateUrl:"modules/Customer/views/inquiry_list.html"}).when("/message",{templateUrl:"modules/Customer/views/message.html"})}]),app.controller("submemberCtrl",["$scope","$rootScope","$http","$modal","API_END_POINT","$log","$filter","ngTableParams","SubmemberFactory",function(e,t,o,n,a,r,s,i,c){e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.tableParams=new i({page:1,count:10},{total:0,getData:function(t,o){c.query({page:o.page(),per_page:o.count()}).then(function(n){e.submemberlist=n.data;var a=o.filter()?s("filter")(e.submemberlist,o.filter()):e.submemberlist,r=o.sorting()?s("orderBy")(a,o.orderBy()):a;o.total(n.count),t.resolve(r)})},$scope:{$data:{}}}),e.del=function(o,n){t.open("确定删除？",function(){c.del(o).then(function(){t.showMsg("删除成功!",{time:500}),e.submemberlist.splice(n,1)})})},e.add=function(o){var a=n.open({templateUrl:"modules/Customer/views/submember_add.html",controller:["$scope","$modalInstance","member",function(e,o,n){e.member=n,t.modalInit(e,o,e.member)}],resolve:{member:function(){return{member_id:o}}}});a.result.then(function(o){c.save(o).then(function(o){t.showMsg("添加成功!",{time:500}),e.submemberlist.unshift(o)})})}}]),app.controller("inquiryCtrl",["$scope","$http","API_END_POINT","$filter","ngTableParams","InquiryFactory",function(e,t,o,n,a,r){e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.tableParams=new a({page:1,count:10},{total:0,getData:function(t,o){r.query({page:o.page(),per_page:o.count()}).then(function(a){e.inquirylist=a.data;var r=o.filter()?n("filter")(e.inquirylist,o.filter()):e.inquirylist,s=o.sorting()?n("orderBy")(r,o.orderBy()):r;o.total(a.count),t.resolve(s)})},$scope:{$data:{}}}),e.del=function(t){$rootScope.open("确定删除？",function(){r.del(t).then(function(){$rootScope.showMsg("删除成功"),e.refreshTable()})},{ok:"确定",cancel:"取消"})},e.refreshTable=function(){r.query({page:e.params.page(),per_page:e.params.count()}).then(function(t){e.inquirylist=t,e.tableParams.reload()})}}]),app.controller("messageCtrl",["$scope","$rootScope","$http","$modal","API_END_POINT","$filter","ngTableParams","MessageFactory",function(e,t,o,n,a,r,s,i){e.reverse=!1,e.checkAll=!1,e.checkAllFn=function(){e.checkAll=!e.checkAll},e.tableParams=new s({page:1,count:10},{total:0,getData:function(t,o){i.query({page:o.page(),per_page:o.count()}).then(function(n){e.messagelist=n.data;var a=o.filter()?r("filter")(e.messagelist,o.filter()):e.messagelist,s=o.sorting()?r("orderBy")(a,o.orderBy()):a;o.total(n.count),t.resolve(s)})},$scope:{$data:{}}}),e.view=function(e){"00"==e.recv_state&&i.save(e).then(function(){t.msgcount=t.msgcount-1,e.recv_state="01"});n.open({templateUrl:"modules/Customer/views/message_view.html",controller:["$scope","$modalInstance","message",function(e,o,n){e.message=n.message,e.msgContent=n.message.content,t.modalInit(e,o,e.message)}],resolve:{message:function(){return{message:e}}}})},e.del=function(o,n){t.open("确定删除？",function(){i.del(o).then(function(){t.showMsg("删除成功!",{time:500}),"00"==o.recv_state&&(t.msgcount=t.msgcount-1),e.messagelist.splice(n,1)})},{ok:"确定",cancel:"取消"})},e.customize=function(){n.open({templateUrl:"modules/Customer/views/customize.html",controller:["$http","API_END_POINT","$scope","$modalInstance",function(e,t,o,n){e.get(t+"profile/customize").success(function(e){o.customize=e}).error(function(){o.customize.type="custommessage"}),o.ok=function(){o.customize.type="custommessage",e.put(t+"profile/customize",o.customize).success(function(e){o.customize=e}).error(function(){}),n.close()},o.cancel=function(){n.dismiss("cancel")}}],resolve:{message:function(){return{content:""}}}})}}]),app.controller("indexMsgCtrl",["$scope","$rootScope","$modal","$http","API_END_POINT","MessageFactory",function(e,t,o,n,a,r){r.query({state:"00",per_page:100}).then(function(o){t.msgcount=o.count,e.msglist=o}),t.view=function(e){"00"===e.recv_state&&r.save({recv_state:"01"}).then(function(){t.msgcount=t.msgcount-1}),o.open({templateUrl:"modules/Customer/views/message_view.html",controller:["$scope","$modalInstance","message",function(e,t,o){e.message=o.message,e.msgContent=o.message.content}],resolve:{message:function(){return{message:e}}}})}}]),app.config(["$routeProvider",function(e){e.when("/seoTemplate",{templateUrl:"modules/Tool/views/seo_template.html"}),e.when("/ltkeywords",{templateUrl:"modules/Tool/views/long_tail_keywords.html"}),e.when("/rss",{templateUrl:"modules/Tool/views/rss_submit.html"}),e.when("/code",{templateUrl:"modules/Tool/views/code.html"})}]),app.controller("ToolCtrl",["$scope","$rootScope","HOST",function(e,t,o){e.tabs=[{title:"MSN",content:"modules/Tool/views/qq/msn.html"},{title:"Skype",content:"modules/Tool/views/qq/skype.html"},{title:"阿里旺旺",content:"modules/Tool/views/qq/aili.html"},{title:"淘宝旺旺",content:"modules/Tool/views/qq/taobao.html"}],e.qqkf=function(){var n=$("#xheQQ").val(),a=$("#xheName").val(),r=$("input[name='displayStyle'][type='radio']:checked").val(),s=$("input[name='showQQstate'][type='radio']:checked").val();if(""==n)return alert("请输入QQ号码"),!1;if(isNaN(n))return alert("对不起，您输入的QQ号码格式错误"),!1;var i=' <a qqstylevlaue="'+r+'" qqstatevalue="'+s+'" qqnumber="'+n+'" href="http://wpa.qq.com/msgrd?v=3&amp;uin='+n+'&amp;site=qq&amp;menu=yes" target="_blank" style="text-decoration:none;"><img _hidetool="true" style="text-decoration:none;cursor:pointer;vertical-align:middle;" qqnumber="'+n+'" src="'+o+"/modules/Tool/views/qq/images/qq"+r+'.gif" border="0" /> '+a+"</a>",c='<a qqstylevlaue="'+r+'" qqstatevalue="'+s+'" qqname="'+a+'" qqnumber="'+n+'" href="http://wpa.qq.com/msgrd?v=3&amp;uin='+n+'&amp;site=qq&amp;menu=yes" target="_blank" style="text-decoration:none;"><img _hidetool="true" style="text-decoration:none;cursor:pointer;vertical-align:middle;" qqname="'+a+'" qqnumber="'+n+'" src="http://wpa.qq.com/pa?p=1:'+n+':45" alt="'+n+'" border="0" /> '+a+"</a>";"0"==s?(t.qqstr=i,e.ok(i)):(t.qqstr=c,e.ok(c))},e.msn_click=function(){var n=$("#xheMSN").val(),a=$("#xheNameMSN").val();if(""==n)return alert("msn账号不能为空!"),!1;var r=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!r.test(n))return alert("MSN格式错误"),!1;var s='<a msnnumber="'+n+'" msnname="'+a+'" href="msnim:chat?contact='+n+'"><img _hidetool="true" style="vertical-align:middle;" src="'+o+'/modules/Tool/views/qq/images/msn.gif" border="0" />'+a+"</a>";t.qqstr=s,e.ok(s)},e.skype_click=function(){var n=$("#xheSkype").val(),a=$("#xheNameSkype").val();if(""==n)return alert("skype账号不能为空"),!1;var r='<a skynumber="'+n+'" skyname="'+a+'" href="skype:'+n+'?call"><img _hidetool="true" src="'+o+'/modules/Tool/views/qq/images/skype2.png" style="border:none;vertical-align:middle;" height="21" width="22" />'+a+"</a>";t.qqstr=r,e.ok(r)},e.ali_click=function(){var n=$("#xheAliWangWang").val(),a=$("#xheNameAliWangWang").val(),r=$("input[name='showAliWangWangstate'][type='radio']:checked").val();if(""==n)return alert("账号不能为空"),!1;var s='<a target="_blank" aliwangwangstatevalue="'+r+'" aliwangwang="'+n+'" aliwangwangname="'+a+'" href="http://amos.alicdn.com/msg.aw?v=2&amp;uid='+n+'&amp;site=cnalichn&amp;s=10&amp;charset=UTF-8"><img _hidetool="true" style="vertical-align:middle;" src="'+o+'/modules/Tool/views/qq/images/online.gif" alt="'+a+'" border="0" />'+a+"</a>",i='<a target="_blank" aliwangwangstatevalue="'+r+'" aliwangwang="'+n+'" aliwangwangname="'+a+'" href="http://amos.alicdn.com/msg.aw?v=2&amp;uid='+n+'&amp;site=cnalichn&amp;s=10&amp;charset=UTF-8"><img _hidetool="true" style="vertical-align:middle;" src="http://amos.alicdn.com/online.aw?v=2&amp;uid='+n+'&amp;site=cnalichn&amp;s=11&amp;charset=UTF-8" alt="'+a+'" border="0" /><span>'+a+"</span></a> ";"0"==r?(t.qqstr=s,e.ok(s)):(t.qqstr=i,e.ok(i))},e.taobao_click=function(){var n=$("#xheTaoBaoWangWang").val(),a=$("#xheNameTaoBaoWangWang").val(),r=$("input[name='showTaoBaoWangWangstate'][type='radio']:checked").val();if(""==n)return alert("账号不能为空"),!1;var s='<a target="_blank" taobaowangwangstatevalue="'+r+'" taobaowangwang="'+n+'" taobaowangwangname="'+a+'" href="http://www.taobao.com/webww/ww.php?ver=3&amp;touid='+n+'&amp;siteid=cntaobao&amp;status=2&amp;charset=utf-8"><img _hidetool="true" style="vertical-align:middle;" src="'+o+'/modules/Tool/views/qq/images/online.gif" alt="'+a+'" border="0" /><span>'+a+"</span></a>",i='<a target="_blank" taobaowangwangstatevalue="'+r+'" taobaowangwang="'+n+'" taobaowangwangname="'+a+'" href="http://www.taobao.com/webww/ww.php?ver=3&amp;touid='+n+'&amp;siteid=cntaobao&amp;status=2&amp;charset=utf-8"><img _hidetool="true" style="vertical-align:middle;" src="http://amos.alicdn.com/online.aw?v=2&amp;uid='+n+'&amp;site=cntaobao&amp;s=2&amp;charset=UTF-8" alt="'+a+'" border="0" />'+a+"</a>";"0"==r?(t.qqstr=s,e.ok(s)):(t.qqstr=i,e.ok(i))},e.qrcodesave=function(){var o='<img src="http://qr.liantu.com/api.php';o+="?bg="+$("#qrcodeBg").val().slice(1),o+="&fg="+$("#qrcodeFg").val().slice(1),o+="&gc="+$("#qrcodeGc").val().slice(1),o+="&w="+$("#qrcodeSize").val(),o+="&text="+unescape(encodeURIComponent($("#qrcodeInfo").val())),o+='"/>',t.codestr=o,e.ok(o)}}]),app.controller("seoTemplateCtrl",["$scope","$rootScope","$http","API_END_POINT",function(e,t,o,n){o.get(n+"seo/template/common").success(function(t){t.page="common",e.seo_common=t}).error(function(){}),o.get(n+"seo/template/news").success(function(t){e.seo_news=t}).error(function(){}),o.get(n+"seo/template/product").success(function(t){e.seo_product=t}).error(function(){}),e.submitSeoCommon=function(){o.put(n+"seo/template/common",e.seo_common).success(function(){t.showMsg("修改成功!",{time:500})}).error(function(){})},e.submitSeoProduct=function(){o.put(n+"seo/template/product",e.seo_product).success(function(){t.showMsg("修改成功!",{time:500})}).error(function(){})},e.submitSeoNews=function(){o.put(n+"seo/template/news",e.seo_news).success(function(){t.showMsg("修改成功!",{time:500})}).error(function(){})},e.impSeo=function(a){"news"==a&&o.post(n+"seo/template/news/apply",e.seo_news).success(function(){t.showMsg("导入成功!")}).error(function(){}),"product"==a&&o.post(n+"seo/template/product/apply",e.seo_product).success(function(){t.showMsg("导入成功!")}).error(function(){}),"common"==a&&o.post(n+"seo/template/common/apply",e.seo_common).success(function(){t.showMsg("导入成功!")}).error(function(){})}}]),app.config(["$httpProvider","fileUploadProvider","API_END_POINT",function(e,t,o){angular.extend(t.defaults,{disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),maxFileSize:5e6,acceptFileTypes:/(\.|\/)(gif|jpe?g|png|swf|flv)$/i,xhrFields:{withCredentials:!0},url:o+"upload"}),"undefined"!=typeof window.UEDITOR_CONFIG&&(window.UEDITOR_CONFIG.imageUrl=o+"upload",window.UEDITOR_CONFIG.imageManagerUrl=o+"album/Album_00000000000000000000000830/att")
}]);var pic_resize=function(e,t){var e=e?e:"upload/system/nopic.jpg",o=e.lastIndexOf("."),n=e.substring(o,e.length);return e.substring(0,o)+"_"+t+n};app.controller("FileUploadCtrl",["$scope","$rootScope","$http","API_END_POINT","AlbumFactory","PictureFactory","$modal",function(e,t,o,n,a,r,s){var i=[{name:"album_id",value:e.albumId}];e.thumb_size={width:80,height:80},e.API_END_POINT=n,e.cateName="",e.searchText="",e.loadingFiles=!0,e.albumId=e.albumId||null,e.page=1,e.pageSize=18,e.pageList=[],e.pageNum=[],e.maxPage=0,e.cur_cate_list=[],e.history=[null],e.breakNav=[],e.temp=null,e.checkboxList=[],e.checkAllFn=function(){e.checkAll=!e.checkAll},e.upload_opts={autoUpload:!0,formData:i,done:function(t,o){setTimeout(function(){o.result[0].thumbnail_path=o.result[0].server_path,e.pageList.unshift(o.result[0]),e.folderReFresh()},1e3)}},e.preUpload=function(){e.albumId||e.folderInto(e.album_list[0].album_id)},e.get_pic=function(t){e.albumId=t,i[0].value=t,r.query(t).then(function(t){e.pic_list=t,e.pagination(t,e.page,e.pageSize)})},e.select_pic=function(t){e.select_list.push(t),e.ok()},e.pic_delete=function(o,n,a){t.open("是否删除该图片？",function(){r.del(e.albumId,o.att_id).then(function(){e.pageList.splice(n,1)})},{ok:"确定",cancel:"取消"}),a.stopPropagation()},e.pic_delete_all=function(){0!==e.checkboxList.length&&t.open("是否删除选中的图片？",function(){r.del(e.checkboxList).then(function(){e.folderReFresh(),e.checkboxList.length=0})},{ok:"确定",cancel:"取消"})},a.query().then(function(t){if(e.album_list=t.data,e.cate_list=e.cur_cate_list=Est.bulidTreeNode(t.data,"parent_id",null,{categoryId:"album_id",belongId:"parent_id",childTag:"children"}),0===e.cate_list.length){var o=$q.defer();return c("默认相册",e.albumId),c("产品图片相册",e.albumId),c("网站装修相册",e.albumId),o.promise}e.albumId&&e.folderInto(e.albumId)}),e.cleanFolder=function(){e.pageList=[],e.cur_cate_list=[]},e.folderInto=function(t){e.cleanFolder(),e.albumId=t,e.history.push(t),e.cur_cate_list=Est.filter(e.album_list,{parent_id:t}),e.get_pic(t),e.breakNav=Est.bulidBreakNav(e.album_list,"album_id",t,"name","parent_id")},e.folderBack=function(){1!==e.history.length&&(e.cleanFolder(),e.history.pop(),e.albumId=e.history[e.history.length-1],e.breakNav=Est.bulidBreakNav(e.album_list,"album_id",e.albumId,"name","parent_id"),e.cur_cate_list=Est.filter(e.album_list,{parent_id:e.albumId}),e.get_pic(e.albumId))},e.folderReFresh=function(){e.cleanFolder(),e.refleshAlbum(),e.get_pic(e.albumId)},e.refleshAlbum=function(){a.query().then(function(t){e.album_list=t.data,e.cate_list=Est.bulidTreeNode(t.data,"parent_id",null,{categoryId:"album_id",belongId:"parent_id",childTag:"children"}),e.cur_cate_list=Est.filter(e.album_list,{parent_id:e.albumId})})};var c=function(t,o){a.save({name:t,parent_id:o}).then(function(t){e.cate_list.push(t)})};e.add_cate=function(){e.cateName&&0!=e.cateName.length&&c(e.cateName,e.albumId)},e.cate_edit=function(t){return e.temp&&(e.temp.edit_show=!1),e.temp=t,t.edit_show=!0},e.cate_edit_save=function(o){return o&&o.name!==e.temp.name&&a.save(o).then(function(){t.showMsg("修改成功！")}),o.edit_show=!1},e.pic_edit=function(t){return e.temp&&(e.temp.edit_show=!1),e.temp=t,t.edit_show=!0},e.pic_edit_save=function(o){return o&&o.filename!==e.temp.filename&&r.save(e.albumId,o).then(function(){t.showMsg("修改成功！")}),o.edit_show=!1},e.pictureReplace=function(o){o.album_id=e.albumId;var n=s.open({templateUrl:"modules/Upload/views/picture_replace.html",resolve:{pic:function(){return o}},controller:["$scope","$modalInstance","pic",function(e,o,n){var a=[{name:"album_id",value:n.album_id},{name:"att_id",value:n.att_id}];e.upload_opts={autoUpload:!0,formData:a,done:function(t,o){o.result[0].thumbnail_path=o.result[0].server_path+"?id="+Est.nextUid(),n=o.result[0],e.ok()}},e.pic=n,t.modalInit(e,o,e.pic)}]});n.result.then(function(o){t.showMsg("替换成功"),setTimeout(function(){e.pic_list.push(o),e.folderReFresh()},1e3)})},e.cate_delete=function(o){t.open("删除该分类会将这个分类下所有的文件全部删除，是否继续？",function(){a.del(o).then(function(){e.folderReFresh()})},{ok:"确定",cancel:"取消"})},e.pagination=function(t,o,n){e.page=o,e.pageList=Est.getListByPage(t,o,n),e.maxPage=Est.getMaxPage(t.length,n),e.pageNum=Est.getPaginationNumber(parseInt(o),parseInt(e.maxPage),9)},e.pageTo=function(t){e.pagination(e.pic_list,t,e.pageSize)},e.pagePre=function(){e.pageTo(1===e.page?1:--e.page)},e.pageNext=function(){e.pageTo(e.page===e.maxPage?e.maxPage:++e.page)},e.copyImgSrc=function(e){var o=s.open({templateUrl:"modules/Upload/views/copy_src.html",controller:["$scope","$modalInstance",function(o,n){o.pic=e,t.modalInit(o,n,o.pic)}],windowClass:"pic-upload-dialog",resolve:{pic:function(){return e}}});o.result.then(function(){t.showMsg("复制成功")})},e.cate_hover=function(e){return e.show_tool=!e.show_tool},e.pic_hover=function(e){return e.show_tool=!e.show_tool},e.checkbox_checked=function(t,o){return o.stopPropagation(),t.checked?e.checkboxList.splice(Est.indexOf(e.checkboxList,t.att_id),1):e.checkboxList.push(t.att_id),t.checked=!t.checked},e.openGalleryUploadDialog=function(){var o=s.open({templateUrl:"modules/Upload/views/file_upload.html",controller:["$scope","$modalInstance","album_id",function(e,o,n){e.select_list=[],e.albumId=n||null,t.modalInit(e,o,e.select_list)}],windowClass:"pic-upload-dialog",resolve:{album_id:function(){return e.albumId}}});o.result.then(function(){e.folderReFresh()})},e.addAlbumDialog=function(){var o=s.open({templateUrl:"modules/Upload/views/album_add.html",controller:["$scope","$modalInstance","album",function(e,o,n){e.album=n||{},t.modalInit(e,o,e.album)}],windowClass:"pic-upload-dialog",resolve:{album:function(){return{name:"",parent_id:e.albumId}}}});o.result.then(function(t){a.save(t).then(function(){e.refleshAlbum()})})},e.search=function(){return 0===e.searchText.length?void e.folderReFresh():(e.pageList=Est.filter(e.pic_list,function(t){return t.filename.indexOf(e.searchText)>-1}),void(e.pageNum=[1]))}}]),app.controller("uploadPicCtrl",["$scope","$rootScope","API_END_POINT",function(e,t,o){e.openFileDialog=function(e,n){t.openFileDialog(function(t){$("."+e).val(t[0].server_path),void 0!=n&&$("."+n).attr("src",o+t[0].server_path)})}}]),app.controller("FlashUploadCtrl",["$scope","$rootScope","$http","API_END_POINT","AlbumFactory","PictureFactory",function(e,t,o,n,a,r){var s=[{name:"album_id",value:e.albumId}];e.API_END_POINT=n,e.cateName="",e.searchText="",e.loadingFiles=!0,e.albumId="",e.thumb_size={width:80,height:80},e.upload_opts={autoUpload:!0,formData:s,done:function(t,o){o.result[0].thumbnail_path=o.result[0].server_path,e.pic_list.unshift(o.result[0])}},e.get_pic=function(t){e.albumId=t,s[0].value=t,r.query(t,{flash:1}).then(function(t){e.pic_list=t})},e.select_pic=function(t){e.select_list.push(t),e.ok()},e.pic_delete=function(o,n,r){t.open("是否删除该flash？",function(){a.del(e.albumId,o.att_id).then(function(){e.pic_list.splice(n,1)})},{ok:"确定",cancel:"取消"}),r.stopPropagation()},a.query().then(function(t){e.cate_list=t.data,e.get_pic(e.cate_list[0].album_id)}),e.checkbox_checked=function(e,t){return t.stopPropagation(),e.checked=!e.checked}}]),app.run(["$rootScope","$modal",function(e,t){e.openFileDialog=function(o){var n=t.open({templateUrl:"modules/Upload/views/file_upload.html",controller:["$scope","$modalInstance","album_id",function(t,o,n){t.select_list=[],t.albumId=n||null,e.modalInit(t,o,t.select_list)}],windowClass:"pic-upload-dialog",resolve:{album_id:function(){return null}}});return n.result.then(function(e){"undefined"!=typeof o&&o.call(null,e)}),!1},e.openFlashDialog=function(o){var n=t.open({templateUrl:"modules/Upload/views/flash_upload.html",controller:["$scope","$modalInstance",function(t,o){t.select_list=[],e.modalInit(t,o,t.select_list)}],windowClass:"pic-upload-dialog",resolve:{album_id:function(){return null}}});return n.result.then(function(e){"undefined"!=typeof o&&o.call(null,e)}),!1}}]),app.config(["$routeProvider",function(e){e.when("/gallery_list",{templateUrl:"modules/Upload/views/gallery_v2.html"})}]),app.controller("GalleryCtrl",["$scope","$rootScope",function(e){e.roleList2=[{roleName:"User",roleId:"role1",collapsed:!0,children:[{roleName:"subUser1",roleId:"role11",collapsed:!0,children:[]},{roleName:"subUser2",roleId:"role12",collapsed:!0,children:[{roleName:"subUser2-1",roleId:"role121",collapsed:!0,children:[{roleName:"subUser2-1-1",roleId:"role1211",collapsed:!0,children:[]},{roleName:"subUser2-1-2",roleId:"role1212",collapsed:!0,children:[]}]}]}]},{roleName:"Admin",roleId:"role2",collapsed:!0,children:[{roleName:"subAdmin1",roleId:"role11",collapsed:!0,children:[]},{roleName:"subAdmin2",roleId:"role12",collapsed:!0,children:[{roleName:"subAdmin2-1",roleId:"role121",collapsed:!0,children:[{roleName:"subAdmin2-1-1",roleId:"role1211",collapsed:!0,children:[]},{roleName:"subAdmin2-1-2",roleId:"role1212",collapsed:!0,children:[]}]}]}]},{roleName:"Guest",roleId:"role3",collapsed:!0,children:[{roleName:"subGuest1",roleId:"role11",collapsed:!0,children:[]},{roleName:"subGuest2",roleId:"role12",collapsed:!0,children:[{roleName:"subGuest2-1",roleId:"role121",collapsed:!0,children:[{roleName:"subGuest2-1-1",roleId:"role1211",collapsed:!0,children:[]},{roleName:"subGuest2-1-2",roleId:"role1212",collapsed:!0,children:[]}]}]}]}]}]);
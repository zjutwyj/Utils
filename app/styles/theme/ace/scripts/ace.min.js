if (!("ace" in window)) {
    window.ace = {}
}
$(function ($) {
    window.ace.click_event = $.fn.tap ? "tap" : "click"
});
$(function () {
    ace.handle_side_menu(jQuery);
    ace.enable_search_ahead(jQuery);
    ace.general_things(jQuery);
    ace.widget_boxes(jQuery);
    ace.widget_reload_handler(jQuery)
});
ace.handle_side_menu = function ($) {
    $("#menu-toggler").on(ace.click_event, function () {
        $("#sidebar").toggleClass("display");
        $(this).toggleClass("display");
        return false
    });
    var isMin = $("#sidebar").hasClass("menu-min");
    $("#sidebar-collapse").on(ace.click_event, function () {
        isMin = $("#sidebar").hasClass("menu-min");
        ace.settings.sidebar_collapsed(!isMin)
    });
    var isMac = navigator.userAgent.match(/OS (5|6|7)(_\d)+ like Mac OS X/i);
    $(".nav-list .dropdown-toggle").on(ace.click_event, function (target) {
        var item = $(this);
        if (!item || item.length == 0) return;
        isMin = $("#sidebar").hasClass("menu-min");
        if (!item.hasClass("dropdown-toggle")) {
            if (isMin && ace.click_event == "tap" && item.get(0).parentNode.parentNode == this) {
                var i = item.find(".menu-text").get(0);
                if (target.target != i && !$.contains(i, target.target)) {
                    return false
                }
            }
            if (isMac) {
                //document.location = item.attr("href");
                return false
            }
            return
        }
        var parent = $(item).parents('li:first');
        parent.siblings().removeClass('active');
        var first = item.next().get(0);
        $(first).find('li').bind('click', function(){
            $(this).siblings().removeClass("active");
            $(this).addClass('active');
        });
        if (!$(first).is(":visible")) {
            if (!first){
                $(".submenu").each(function () {
                    if (!$(this.parentNode).hasClass("active")) {
                        $(this).slideUp(200).parent().removeClass("open");
                        $(this).parents('li:first').removeClass('active');
                    }
                })
            } else{
                var ul = $(first.parentNode).closest("ul");
                if (isMin && d.hasClass("nav-list")) {
                    return
                }
                ul.find(" .submenu").each(function () {
                    if (!$(this.parentNode).hasClass("active")) {
                        $(this).slideUp(200).parent().removeClass("open");
                        $(this).find('li').removeClass('active');
                    }
                })
            }
        } else {
        }
        if (isMin && $(first.parentNode.parentNode).hasClass("nav-list")) {
            return false
        }
        $(first).slideToggle(200).parent().toggleClass("open");

         parent.addClass('active');
        return false
    })
};
ace.general_things = function ($) {
    $('.ace-nav [class*="icon-animated-"]').closest("a").on("click", function () {
        var d = a(this).find('[class*="icon-animated-"]').eq(0);
        var c = d.attr("class").match(/icon\-animated\-([\d\w]+)/);
        d.removeClass(c[0]);
        $(this).off("click")
    });
    //a(".nav-list .badge[title],.nav-list .label[title]").tooltip({placement: "right"});
    $("#ace-settings-btn").on(ace.click_event, function () {
        $(this).toggleClass("open");
        $("#ace-settings-box").toggleClass("open")
    });
    $("#ace-settings-navbar").on("click",function () {
        ace.settings.navbar_fixed(this.checked)
    }).each(function () {
        this.checked = ace.settings.is("navbar", "fixed")
    });
    $("#ace-settings-sidebar").on("click",function () {
        ace.settings.sidebar_fixed(this.checked)
    }).each(function () {
        this.checked = ace.settings.is("sidebar", "fixed")
    });
    $("#ace-settings-breadcrumbs").on("click",function () {
        ace.settings.breadcrumbs_fixed(this.checked)
    }).each(function () {
        this.checked = ace.settings.is("breadcrumbs", "fixed")
    });
    $("#ace-settings-add-container").on("click",function () {
        ace.settings.main_container_fixed(this.checked)
    }).each(function () {
        this.checked = ace.settings.is("main-container", "fixed")
    });
    $("#ace-settings-rtl").removeAttr("checked").on("click", function () {
        ace.switch_direction(jQuery)
    });
    $("#btn-scroll-up").on(ace.click_event, function () {
        var c = Math.min(400, Math.max(100, parseInt($("html").scrollTop() / 3)));
        $("html,body").animate({scrollTop: 0}, c);
        return false
    });
    try {
        $("#skin-colorpicker").ace_colorpicker()
    } catch (b) {
    }
    $("#skin-colorpicker").on("change", function () {
        var d = $(this).find("option:selected").data("skin");
        var c = $(document.body);
        c.removeClass("skin-1 skin-2 skin-3");
        if (d != "default") {
            c.addClass(d)
        }
        if (d == "skin-1") {
            $(".ace-nav > li.grey").addClass("dark")
        } else {
            $(".ace-nav > li.grey").removeClass("dark")
        }
        if (d == "skin-2") {
            $(".ace-nav > li").addClass("no-border margin-1");
            $(".ace-nav > li:not(:last-child)").addClass("light-pink").find('> a > [class*="icon-"]').addClass("pink").end().eq(0).find(".badge").addClass("badge-warning")
        } else {
            $(".ace-nav > li").removeClass("no-border margin-1");
            $(".ace-nav > li:not(:last-child)").removeClass("light-pink").find('> a > [class*="icon-"]').removeClass("pink").end().eq(0).find(".badge").removeClass("badge-warning")
        }
        if (d == "skin-3") {
            $(".ace-nav > li.grey").addClass("red").find(".badge").addClass("badge-yellow")
        } else {
            $(".ace-nav > li.grey").removeClass("red").find(".badge").removeClass("badge-yellow")
        }
    })
};
ace.widget_boxes = function ($) {
    $(document).on("hide.bs.collapse show.bs.collapse", function (c) {
        var b = c.target.getAttribute("id");
        $('[href*="#' + b + '"]').find('[class*="icon-"]').each(function () {
            var e = $(this);
            var d;
            var f = null;
            var g = null;
            if ((f = e.attr("data-icon-show"))) {
                g = e.attr("data-icon-hide")
            } else {
                if (d = e.attr("class").match(/icon\-(.*)\-(up|down)/)) {
                    f = "icon-" + d[1] + "-down";
                    g = "icon-" + d[1] + "-up"
                }
            }
            if (f) {
                if (c.type == "show") {
                    e.removeClass(f).addClass(g)
                } else {
                    e.removeClass(g).addClass(f)
                }
                return false
            }
        })
    });
    $(document).on("click.ace.widget", "[data-action]", function (o) {
        o.preventDefault();
        var n = $(this);
        var p = n.data("action");
        var b = n.closest(".widget-box");
        if (b.hasClass("ui-sortable-helper")) {
            return
        }
        if (p == "collapse") {
            var j = b.hasClass("collapsed") ? "show" : "hide";
            var f = j == "show" ? "shown" : "hidden";
            var c;
            b.trigger(c = a.Event(j + ".ace.widget"));
            if (c.isDefaultPrevented()) {
                return
            }
            var g = b.find(".widget-body");
            var m = n.find("[class*=icon-]").eq(0);
            var h = m.attr("class").match(/icon\-(.*)\-(up|down)/);
            var d = "icon-" + h[1] + "-down";
            var i = "icon-" + h[1] + "-up";
            var l = g.find(".widget-body-inner");
            if (l.length == 0) {
                g = g.wrapInner('<div class="widget-body-inner"></div>').find(":first-child").eq(0)
            } else {
                g = l.eq(0)
            }
            var e = 300;
            var k = 200;
            if (j == "show") {
                if (m) {
                    m.addClass(i).removeClass(d)
                }
                b.removeClass("collapsed");
                g.slideUp(0, function () {
                    g.slideDown(e, function () {
                        b.trigger(c = a.Event(f + ".ace.widget"))
                    })
                })
            } else {
                if (m) {
                    m.addClass(d).removeClass(i)
                }
                g.slideUp(k, function () {
                    b.addClass("collapsed");
                    b.trigger(c = a.Event(f + ".ace.widget"))
                })
            }
        } else {
            if (p == "close") {
                var c;
                b.trigger(c = a.Event("close.ace.widget"));
                if (c.isDefaultPrevented()) {
                    return
                }
                var r = parseInt(n.data("close-speed")) || 300;
                b.hide(r, function () {
                    b.trigger(c = a.Event("closed.ace.widget"));
                    b.remove()
                })
            } else {
                if (p == "reload") {
                    var c;
                    b.trigger(c = a.Event("reload.ace.widget"));
                    if (c.isDefaultPrevented()) {
                        return
                    }
                    n.blur();
                    var q = false;
                    if (b.css("position") == "static") {
                        q = true;
                        b.addClass("position-relative")
                    }
                    b.append('<div class="widget-box-overlay"><i class="icon-spinner icon-spin icon-2x white"></i></div>');
                    b.one("reloaded.ace.widget", function () {
                        b.find(".widget-box-overlay").remove();
                        if (q) {
                            b.removeClass("position-relative")
                        }
                    })
                } else {
                    if (p == "settings") {
                        var c = a.Event("settings.ace.widget");
                        b.trigger(c)
                    }
                }
            }
        }
    })
};
ace.widget_reload_handler = function ($) {
    $(document).on("reload.ace.widget", ".widget-box", function (b) {
        var c = $(this);
        setTimeout(function () {
            c.trigger("reloaded.ace.widget")
        }, parseInt(Math.random() * 1000 + 1000))
    })
};
ace.enable_search_ahead = function (a) {
    ace.variable_US_STATES = ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Dakota", "North Carolina", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"];
    try {
        $("#nav-search-input").typeahead({source: ace.variable_US_STATES, updater: function (c) {
            $("#nav-search-input").focus();
            return c
        }})
    } catch (b) {
    }
};
ace.switch_direction = function (d) {
    var c = d(document.body);
    c.toggleClass("rtl").find(".dropdown-menu:not(.datepicker-dropdown,.colorpicker)").toggleClass("pull-right").end().find(".pull-right:not(.dropdown-menu,blockquote,.profile-skills .pull-right)").removeClass("pull-right").addClass("tmp-rtl-pull-right").end().find(".pull-left:not(.dropdown-submenu,.profile-skills .pull-left)").removeClass("pull-left").addClass("pull-right").end().find(".tmp-rtl-pull-right").removeClass("tmp-rtl-pull-right").addClass("pull-left").end().find(".chosen-container").toggleClass("chosen-rtl").end();
    function a(h, g) {
        c.find("." + h).removeClass(h).addClass("tmp-rtl-" + h).end().find("." + g).removeClass(g).addClass(h).end().find(".tmp-rtl-" + h).removeClass("tmp-rtl-" + h).addClass(g)
    }

    function b(h, g, i) {
        i.each(function () {
            var k = d(this);
            var j = k.css(g);
            k.css(g, k.css(h));
            k.css(h, j)
        })
    }

    a("align-left", "align-right");
    a("no-padding-left", "no-padding-right");
    a("arrowed", "arrowed-right");
    a("arrowed-in", "arrowed-in-right");
    a("messagebar-item-left", "messagebar-item-right");
    var e = d("#piechart-placeholder");
    if (e.size() > 0) {
        var f = d(document.body).hasClass("rtl") ? "nw" : "ne";
        e.data("draw").call(e.get(0), e, e.data("chart"), f)
    }
};
